{"version":3,"file":"TextField.js","sources":["../../../../src/Shared/Form/TextField.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { Icon } from \"@iconify/react\";\nimport styled from \"@emotion/styled\";\nimport { useHass } from \"@hakit/core\";\n\nexport interface TextFieldProps extends React.ComponentPropsWithoutRef<\"div\"> {\n  type?: string;\n  value?: string;\n  errorMessage?: string;\n  label?: string;\n  placeholder?: string;\n  leadingIcon?: string;\n  trailingIcon?: string;\n  minLength?: number;\n  maxLength?: number;\n  min?: number;\n  max?: number;\n  helperText?: string;\n  charCounter?: boolean;\n  disabled?: boolean;\n  inputProps?: React.ComponentPropsWithoutRef<\"input\">;\n}\n\nconst TextFieldBase = styled.div`\n  --padding-horizontal: 14px;\n  --padding-horizontal-icon: 8px;\n  --padding-vertical: 16px;\n  --floating-label-padding-horizontal: 4px;\n  --margin-vertical: 16px;\n  --transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);\n  --transition-duration: 0.4s;\n  --border-width: 1px;\n  --border-width-active: 2px;\n  --icon-size: 24px;\n  --icon-margin: 12px;\n  --border-radius: 4px;\n  --font-size: 16;\n  --label-font-size-active: 12;\n  --label-scale-factor: calc(var(--label-font-size-active) / var(--font-size));\n  --label-scale-width: calc((100% - var(--padding-horizontal) * 2 - var(--floating-label-padding-horizontal)) / var(--label-scale-factor));\n\n  margin: var(--margin-vertical) 0;\n\n  &:disabled,\n  &.disabled {\n    cursor: not-allowed;\n    opacity: 0.8;\n  }\n\n  .field-wrapper {\n    align-items: center;\n    display: flex;\n    flex-direction: row;\n    position: relative;\n  }\n\n  .field-wrapper input,\n  .field-wrapper label {\n    font-size: calc(var(--font-size) * 1px);\n  }\n\n  .field-wrapper input {\n    background: transparent;\n    border: none;\n    color: var(--ha-S200-contrast);\n    padding: var(--padding-vertical) var(--padding-horizontal);\n    outline: none;\n    width: 100%;\n  }\n\n  .field-wrapper input:-moz-ui-invalid {\n    box-shadow: none !important;\n  }\n\n  .field-wrapper i {\n    color: var(--ha-S200-contrast);\n    margin: 0 var(--icon-margin);\n    pointer-events: none;\n    width: var(--icon-size);\n  }\n\n  .field-wrapper label {\n    color: var(--ha-S400-contrast);\n    pointer-events: none;\n  }\n\n  .field-wrapper label.floating {\n    left: var(--padding-horizontal);\n    line-height: calc((var(--label-font-size-active) * 1px) * 1.45);\n    max-width: calc(100% - var(--padding-horizontal) * 2);\n    overflow: hidden;\n    position: absolute;\n    text-overflow: ellipsis;\n    transition-duration: var(--transition-duration);\n    transform-origin: 0 0;\n    transition-property: color, font-size, padding, transform, max-width, left;\n    transition-timing-function: var(--transition-timing-function);\n    white-space: nowrap;\n  }\n\n  .field-wrapper label.reference {\n    max-width: var(--label-scale-width);\n    padding: 0 var(--floating-label-padding-horizontal) 0 0;\n    transform: scale3d(var(--label-scale-factor), var(--label-scale-factor), 1);\n  }\n\n  .field-wrapper._leading-icon,\n  .field-wrapper._trailing-icon label.floating:not(.reference) {\n    max-width: calc(100% - var(--icon-size) + (var(--icon-margin) * 2) + var(--padding-horizontal));\n  }\n\n  .field-wrapper._leading-icon._trailing-icon label.floating:not(.reference) {\n    max-width: calc(100% - ((var(--icon-size) + (var(--icon-margin) * 2)) * 2));\n  }\n\n  .field-wrapper._leading-icon input {\n    padding-left: 0;\n  }\n\n  .field-wrapper._leading-icon label.floating:not(.reference) {\n    left: calc(var(--icon-size) + (var(--icon-margin) * 2));\n  }\n\n  .field-wrapper._trailing-icon input {\n    padding-right: 0;\n  }\n\n  .borders {\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n    pointer-events: none;\n    position: absolute;\n    width: 100%;\n  }\n\n  .borders .border {\n    border-color: var(--ha-S300);\n    border-style: solid;\n    transition-duration: var(--transition-duration);\n    transition-property: border-color, width;\n    transition-timing-function: var(--transition-timing-function);\n  }\n\n  .borders .middle {\n    display: flex;\n    flex: 1 1 auto;\n    flex-direction: column;\n  }\n\n  .borders .middle .top-borders {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n  }\n\n  .borders .middle .top-borders .border {\n    border-width: var(--border-width) 0 0;\n    flex: unset;\n  }\n\n  .borders .middle .top-borders .border.start {\n    width: calc(var(--label-active-width) / 2);\n  }\n\n  .borders .middle .border {\n    flex: 1 1 auto;\n    width: 100%;\n  }\n\n  .borders .middle .border.bottom {\n    border-width: 0 0 var(--border-width) 0;\n  }\n\n  .borders .left,\n  .borders .right {\n    width: calc(var(--padding-horizontal) - var(--floating-label-padding-horizontal) - var(--border-width));\n  }\n\n  .borders .left {\n    border-radius: var(--border-radius) 0 0 var(--border-radius);\n    border-width: var(--border-width) 0 var(--border-width) var(--border-width);\n  }\n\n  .borders .right {\n    border-radius: 0 var(--border-radius) var(--border-radius) 0;\n    border-width: var(--border-width) var(--border-width) var(--border-width) 0;\n  }\n\n  .field-wrapper._floating-label._focused .borders .top-borders .start,\n  .field-wrapper._floating-label._has-value .borders .top-borders .start {\n    width: 0;\n  }\n\n  .field-wrapper._floating-label._focused .borders .top-borders .end,\n  .field-wrapper._floating-label._has-value .borders .top-borders .end {\n    width: calc(100% - var(--label-active-width, 0) - var(--floating-label-padding-horizontal));\n  }\n\n  .field-wrapper._floating-label._focused label.floating:not(.reference),\n  .field-wrapper._floating-label._has-value label.floating:not(.reference) {\n    left: var(--padding-horizontal);\n    max-width: var(--label-scale-width);\n    padding: 0 var(--floating-label-padding-horizontal) 0 0;\n    transform: translate3d(0, calc(-100% - var(--label-font-size-active) * 0.5px), 0)\n      scale3d(var(--label-scale-factor), var(--label-scale-factor), 1);\n  }\n\n  .field-wrapper._focused label.floating {\n    color: var(--ha-300);\n  }\n\n  .field-wrapper._focused .borders .top-borders .border {\n    border-width: var(--border-width-active) 0 0;\n  }\n\n  .field-wrapper._focused .borders .border {\n    border-color: var(--ha-300);\n  }\n\n  .field-wrapper._focused .borders .border.bottom {\n    border-width: 0 0 var(--border-width-active) 0;\n  }\n\n  .field-wrapper._focused .borders .border.left {\n    border-width: var(--border-width-active) 0 var(--border-width-active) var(--border-width-active);\n  }\n\n  .field-wrapper._focused .borders .border.right {\n    border-width: var(--border-width-active) var(--border-width-active) var(--border-width-active) 0;\n  }\n\n  .field-wrapper._invalid .borders .border {\n    border-color: var(--ha-alert-error-color);\n  }\n\n  .field-wrapper._invalid label.floating {\n    color: var(--ha-alert-error-color);\n  }\n\n  .hints {\n    color: var(--ha-S400-contrast);\n    display: flex;\n    flex-direction: row;\n    font-size: 12px;\n    margin: 4px 12px 0 12px;\n  }\n\n  .hints .messages {\n    flex: 1 1 auto;\n  }\n\n  .hints .error {\n    color: var(--ha-alert-error-color);\n  }\n\n  .hints .char-counter {\n    margin: 0 0 0 12px;\n  }\n`;\n\nexport const TextField: React.FC<TextFieldProps> = ({\n  type = \"text\",\n  value: initialValue = \"\",\n  errorMessage: initialErrorMessage = null,\n  label,\n  placeholder,\n  leadingIcon,\n  trailingIcon,\n  minLength,\n  maxLength,\n  min,\n  max,\n  helperText,\n  charCounter,\n  inputProps,\n  className,\n  disabled,\n  ...rest\n}) => {\n  const windowContext = useHass((store) => store.windowContext);\n  const win = windowContext ?? window;\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = useState<string | null>(initialValue);\n  const [errorMessage, setErrorMessage] = useState<string | null>(initialErrorMessage);\n  const [valid, setValid] = useState(true);\n\n  const container = useRef<HTMLDivElement>(null);\n  const floatingLabelRef = useRef<HTMLLabelElement>(null);\n  const inputField = useRef<HTMLInputElement>(null);\n\n  const setLabelWidthStyleProperty = () => {\n    if (floatingLabelRef.current && container.current) {\n      const dims = floatingLabelRef.current.getBoundingClientRect();\n      container.current.style.setProperty(\"--label-active-width\", `${dims.width}px`);\n    } else if (container.current) {\n      container.current.style.setProperty(\"--label-active-width\", \"0px\");\n    }\n  };\n\n  useEffect(() => {\n    setLabelWidthStyleProperty();\n    win.addEventListener(\"resize\", setLabelWidthStyleProperty);\n    return () => {\n      win.removeEventListener(\"resize\", setLabelWidthStyleProperty);\n    };\n  }, [win]);\n\n  const focusField = () => {\n    inputField.current?.focus();\n  };\n\n  const onFocus = () => {\n    setFocused(true);\n    setLabelWidthStyleProperty();\n  };\n\n  const onBlur = () => {\n    setFocused(false);\n  };\n\n  const updateValue = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setValue(e.target.value);\n    updateValidity();\n  };\n\n  const updateValidity = () => {\n    if (!inputField.current) return;\n    setValid(inputField.current.checkValidity());\n  };\n\n  const getStyleClasses = () => {\n    const classes = [];\n    if (label) classes.push(\"_floating-label\");\n    if (leadingIcon) classes.push(\"_leading-icon\");\n    if (trailingIcon) classes.push(\"_trailing-icon\");\n    if (!valid) classes.push(\"_invalid\");\n    if (value) classes.push(\"_has-value\");\n    if (focused) classes.push(\"_focused\");\n    if (disabled) classes.push(\"disabled\");\n    return classes.join(\" \");\n  };\n\n  const showHintContainer = () => {\n    return errorMessage || helperText || charCounter;\n  };\n\n  const setError = (errorMessage: string) => {\n    if (!inputField.current) return;\n    inputField.current.setCustomValidity(errorMessage);\n    setValid(false);\n    setErrorMessage(errorMessage);\n  };\n\n  useEffect(() => {\n    setValue(initialValue);\n  }, [initialValue]);\n\n  useEffect(() => {\n    if (!valid) {\n      setError(\"This field is required\");\n    }\n  }, [valid]);\n\n  return (\n    <TextFieldBase className={`outline-input ${className ?? \"\"}`} {...rest} ref={container}>\n      <div className={`field-wrapper ${getStyleClasses()}`} onClick={focusField}>\n        {label ? <label className=\"floating\">{label}</label> : null}\n        {label ? (\n          <label\n            ref={floatingLabelRef}\n            className=\"floating reference\"\n            style={{ opacity: 0, pointerEvents: \"none\", visibility: \"hidden\", zIndex: -9999999999 }}\n          >\n            {label}\n          </label>\n        ) : null}\n        {leadingIcon ? (\n          <Icon\n            className={\"icon leading\"}\n            icon={leadingIcon}\n            style={{\n              color: `var(--ha-500-contrast)`,\n            }}\n          />\n        ) : null}\n        <input\n          ref={inputField}\n          type={type}\n          minLength={minLength}\n          maxLength={maxLength}\n          min={min}\n          max={max}\n          placeholder={focused && label ? placeholder : placeholder}\n          value={value || \"\"}\n          onChange={updateValue}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          disabled={disabled}\n          {...inputProps}\n        />\n        {trailingIcon ? (\n          <Icon\n            className={\"icon trailing\"}\n            icon={trailingIcon}\n            style={{\n              color: `var(--ha-500-contrast)`,\n            }}\n          />\n        ) : null}\n        <div className=\"borders\">\n          <div className=\"border left\" />\n          <div className=\"middle\">\n            <div className=\"top-borders\">\n              <div className=\"border start\" />\n              <div className=\"border end\" />\n            </div>\n            <div className=\"border bottom\" />\n          </div>\n          <div className=\"border right\" />\n        </div>\n      </div>\n      {showHintContainer() ? (\n        <div className=\"hints\">\n          {errorMessage || helperText ? (\n            <div className=\"messages\">\n              {!valid && errorMessage ? <div className=\"error\">{errorMessage}</div> : null}\n              {valid && helperText ? <div className=\"helper\">{helperText}</div> : null}\n            </div>\n          ) : null}\n          {maxLength ? (\n            <div className=\"char-counter\">\n              {value ? value.length : 0}/{maxLength}\n            </div>\n          ) : null}\n        </div>\n      ) : null}\n    </TextFieldBase>\n  );\n};\n"],"names":["TextFieldBase","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","TextField","type","value","initialValue","errorMessage","initialErrorMessage","placeholder","leadingIcon","trailingIcon","minLength","maxLength","min","max","helperText","charCounter","inputProps","className","disabled","rest","win","useHass","store","windowContext","window","focused","setFocused","useState","setValue","setErrorMessage","valid","setValid","container","useRef","floatingLabelRef","inputField","setLabelWidthStyleProperty","current","dims","getBoundingClientRect","style","setProperty","width","useEffect","addEventListener","removeEventListener","focusField","focus","onFocus","onBlur","updateValue","e","updateValidity","checkValidity","getStyleClasses","classes","push","join","showHintContainer","setError","setCustomValidity","jsxs","jsx","opacity","pointerEvents","visibility","zIndex","Icon","color","length"],"mappings":"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"}