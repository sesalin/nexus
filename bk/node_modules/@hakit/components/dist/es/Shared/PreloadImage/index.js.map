{"version":3,"file":"index.js","sources":["../../../../src/Shared/PreloadImage/index.tsx"],"sourcesContent":["import { useEffect, useRef, useCallback } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { css } from \"@emotion/react\";\n\nimport { Icon } from \"@iconify/react\";\n\nconst Preloader = styled.div`\n  position: relative;\n`;\n\nconst PreloaderBackground = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  transition-property: background-image, opacity;\n  opacity: 0;\n`;\nconst StyledIcon = styled(Icon)`\n  opacity: 0;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 2rem;\n`;\nexport interface PreloadImageProps extends Omit<React.ComponentPropsWithoutRef<\"div\">, \"onLoad\" | \"onError\"> {\n  lazy?: boolean;\n  src: string;\n  style?: React.CSSProperties;\n  innerStyle?: {\n    backgroundSize?: string;\n    backgroundPosition?: string;\n    backgroundRepeat?: string;\n  };\n  /** duration of the fade in animation in milliseconds */\n  duration?: number;\n  ease?: string;\n  children?: React.ReactNode;\n  onClick?: () => void;\n  onLoad?: () => void;\n  onError?: () => void;\n  onLoading?: () => void;\n}\n\n/** The PreloadImage is a helper component to load an image into the background of the element, this component is pretty generic and requires additional styling to set the width/height of the\n * background image element\n *\n * It will automatically fade in the image once it's loaded, and will show a loading icon while it's loading, everything is pretty configurable and is completely documented\n */\nexport const PreloadImage = ({\n  lazy,\n  src,\n  className,\n  style,\n  innerStyle,\n  duration: _duration,\n  ease,\n  children,\n  onLoad,\n  onLoading,\n  onError,\n  onClick,\n  cssStyles,\n  ...rest\n}: PreloadImageProps) => {\n  const el = useRef<HTMLDivElement>(null);\n  const loadingIconRef = useRef<SVGSVGElement | null>(null);\n  const imageDivRef = useRef<HTMLDivElement | null>(null);\n  const observer = useRef<IntersectionObserver | null>(null);\n  const preloader = useRef<HTMLImageElement | null>(null);\n  const duration = _duration ?? 300;\n\n  const setPreloader = useCallback(() => {\n    if (!src) return;\n    preloader.current = new Image();\n    if (typeof onLoading === \"function\") {\n      onLoading();\n    }\n    if (imageDivRef.current) {\n      imageDivRef.current.style.opacity = \"0\";\n      imageDivRef.current.style.backgroundImage = `url(${src})`;\n    }\n    if (loadingIconRef.current) {\n      loadingIconRef.current.style.opacity = \"1\";\n    }\n\n    preloader.current.onload = () => {\n      if (imageDivRef.current) {\n        imageDivRef.current.style.opacity = \"1\";\n      }\n      if (loadingIconRef.current) {\n        loadingIconRef.current.style.opacity = \"0\";\n      }\n      if (typeof onLoad === \"function\") {\n        onLoad();\n      }\n    };\n    preloader.current.onerror = () => {\n      if (imageDivRef.current) {\n        imageDivRef.current.style.opacity = \"1\";\n      }\n      if (loadingIconRef.current) {\n        loadingIconRef.current.style.opacity = \"0\";\n      }\n      if (typeof onError === \"function\") {\n        onError();\n      }\n    };\n\n    preloader.current.src = src;\n  }, [src, onLoading, onLoad, onError]);\n\n  const setObserver = useCallback(() => {\n    observer.current = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          setPreloader();\n          if (observer.current) observer.current.disconnect();\n        }\n      });\n    });\n\n    if (el.current) observer.current.observe(el.current);\n  }, [setPreloader]);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && lazy && \"IntersectionObserver\" in window) {\n      setObserver();\n    } else {\n      setPreloader();\n    }\n\n    return () => {\n      if (observer.current) observer.current.disconnect();\n      if (preloader.current) preloader.current.onload = null;\n    };\n  }, [lazy, observer, preloader, setObserver, setPreloader]);\n\n  const backgroundSize = innerStyle?.backgroundSize || \"cover\";\n  const backgroundPosition = innerStyle?.backgroundPosition || \"center\";\n  const backgroundRepeat = innerStyle?.backgroundRepeat || \"no-repeat\";\n\n  return (\n    <Preloader\n      css={css`\n        ${cssStyles ?? \"\"}\n      `}\n      className={`preload-image ${className ?? \"\"}`}\n      style={{ ...style }}\n      ref={el}\n      {...rest}\n      onClick={onClick}\n    >\n      <PreloaderBackground\n        className=\"preloader-background-image\"\n        ref={imageDivRef}\n        style={{\n          backgroundSize: backgroundSize,\n          backgroundPosition: backgroundPosition,\n          backgroundRepeat: backgroundRepeat,\n          transitionProperty: \"background-image, opacity\",\n          transitionDuration: `${duration}ms, ${duration}ms`,\n          transitionTimingFunction: `${ease ?? \"cubic-bezier(0.215, 0.61, 0.355, 1)\"}, ${ease ?? \"cubic-bezier(0.215, 0.61, 0.355, 1)\"}`,\n        }}\n      ></PreloaderBackground>\n      <StyledIcon ref={loadingIconRef} icon=\"eos-icons:three-dots-loading\" className=\"preloader-loading-icon\" />\n      {children}\n    </Preloader>\n  );\n};\n"],"names":["Preloader","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","PreloaderBackground","StyledIcon","Icon","PreloadImage","lazy","src","className","style","innerStyle","duration","_duration","ease","children","onLoad","onLoading","onError","onClick","cssStyles","rest","el","useRef","loadingIconRef","imageDivRef","observer","preloader","setPreloader","useCallback","current","Image","opacity","backgroundImage","onload","onerror","setObserver","IntersectionObserver","entries","forEach","entry","isIntersecting","disconnect","observe","useEffect","window","backgroundSize","backgroundPosition","backgroundRepeat","jsx","transitionProperty","transitionDuration","transitionTimingFunction"],"mappings":"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"}