{"version":3,"file":"toggle.js","sources":["../../../../../src/Cards/EntitiesCard/action-types/toggle.tsx"],"sourcesContent":["import styled from \"@emotion/styled\";\nimport { type EntityName, computeDomain, isUnavailableState, ON, OFF, useHass } from \"@hakit/core\";\nimport { useState, useEffect, useRef } from \"react\";\nimport Switch from \"react-switch\";\nimport { StateProps } from \"./types\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  white-space: nowrap;\n`;\n\nconst StyledSwitch = styled(Switch)`\n  color: var(--ha-100);\n  .react-switch-bg {\n    background: var(--ha-S100) !important;\n  }\n  &.checked {\n    .react-switch-bg {\n      background: var(--ha-A400) !important;\n    }\n  }\n`;\n\nexport default function ToggleState({ entity, className, ...rest }: StateProps) {\n  const timeout = useRef<NodeJS.Timeout | null>(null);\n  const formatter = useHass((store) => store.formatter);\n  const isUnavailable = isUnavailableState(entity.state);\n\n  const showToggle = entity.state === ON || entity.state === OFF || isUnavailable;\n  const [isOn, setIsOn] = useState(entity.state === ON);\n\n  const _callService = async (turnOn: boolean): Promise<void> => {\n    const stateDomain = computeDomain(entity.entity_id as EntityName);\n    let service;\n\n    if (stateDomain === \"lock\") {\n      service = turnOn ? \"unlock\" : \"lock\";\n    } else if (stateDomain === \"cover\") {\n      service = turnOn ? \"open_cover\" : \"close_cover\";\n    } else if (stateDomain === \"valve\") {\n      service = turnOn ? \"open_valve\" : \"close_valve\";\n    } else if (stateDomain === \"group\") {\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    } else {\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    }\n    const previousIsOn = isOn;\n    setIsOn(turnOn);\n    if (timeout.current) clearTimeout(timeout.current);\n    // wait 2 seconds, if the state hasn't updated, revert the switch\n    timeout.current = setTimeout(() => {\n      setIsOn(previousIsOn);\n    }, 2000);\n\n    try {\n      // @ts-expect-error - this is fine, types are wrong\n      await entity.service[service]();\n      if (timeout.current) clearTimeout(timeout.current);\n      timeout.current = null;\n    } catch (err) {\n      console.error(\"Error calling service\", err);\n      if (timeout.current) clearTimeout(timeout.current);\n      timeout.current = null;\n      setIsOn(previousIsOn);\n    }\n  };\n\n  useEffect(() => {\n    if (timeout.current || isOn === (entity.state === ON)) return;\n    setIsOn(entity.state === ON);\n  }, [entity.state, isOn]);\n\n  return (\n    <Wrapper className={`action-type-toggle ${className}`} {...rest}>\n      {showToggle ? (\n        <StyledSwitch\n          disabled={isUnavailable}\n          checked={isOn}\n          className={`${isOn ? \"checked\" : \"\"}`}\n          // These will not be used, i've only included these so it's clear that they are not used\n          onColor=\"#fff\"\n          offColor=\"#fff\"\n          checkedIcon={false}\n          uncheckedIcon={false}\n          height={20}\n          width={37}\n          onChange={() => _callService(isOn ? false : true)}\n        />\n      ) : (\n        <div className=\"text-content\">{formatter.stateValue(entity)}</div>\n      )}\n    </Wrapper>\n  );\n}\n"],"names":["Wrapper","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","StyledSwitch","Switch","ToggleState","entity","className","rest","timeout","useRef","formatter","useHass","store","isUnavailable","isUnavailableState","state","showToggle","ON","OFF","isOn","setIsOn","useState","_callService","turnOn","stateDomain","computeDomain","entity_id","service","previousIsOn","current","clearTimeout","setTimeout","err","console","error","useEffect","jsx","stateValue"],"mappings":";;;;;;;;AAMA,MAAMA,IAAOC,gBAAAA,EAAA,OAAAC,QAAAC,IAAAC,aAAA,eAAA;AAAA,EAAAC,QAAA;AAAA,IAAA;AAAA,EAAAA,QAAA;AAAA,EAAAC,OAAA;AAAA,CAAA,EAAAJ,QAAAC,IAAAC,aAAA,eAAA;AAAA,EAAAG,MAAA;AAAA,EAAAC,QAAA;AAAA,IAAA;AAAA,EAAAD,MAAA;AAAA,EAAAC,QAAA;AAAA,EAAAC,UAAAC;AAAA,CAAA,GAOPC,IAAeV,gBAAAA,EAAOW,GAAMV,QAAAC,IAAAC,aAAA,eAAA;AAAA,EAAAC,QAAA;AAAA,IAAA;AAAA,EAAAA,QAAA;AAAA,EAAAC,OAAA;AAAA,CAAA,EAACJ,QAAAC,IAAAC,aAAA,eAAA;AAAA,EAAAG,MAAA;AAAA,EAAAC,QAAA;AAAA,IAAA;AAAA,EAAAD,MAAA;AAAA,EAAAC,QAAA;AAAA,EAAAC,UAAAC;AAAA,CAAA;AAYnC,SAAwBG,EAAY;AAAA,EAAEC,QAAAA;AAAAA,EAAQC,WAAAA;AAAAA,EAAW,GAAGC;AAAiB,GAAG;AAC9E,QAAMC,IAAUC,EAA8B,IAAI,GAC5CC,IAAYC,EAASC,CAAAA,MAAUA,EAAMF,SAAS,GAC9CG,IAAgBC,EAAmBT,EAAOU,KAAK,GAE/CC,IAAaX,EAAOU,UAAUE,KAAMZ,EAAOU,UAAUG,KAAOL,GAC5D,CAACM,GAAMC,CAAO,IAAIC,EAAShB,EAAOU,UAAUE,CAAE,GAE9CK,IAAe,OAAOC,MAAmC;AAC7D,UAAMC,IAAcC,EAAcpB,EAAOqB,SAAuB;AAChE,QAAIC;AAEJ,IAAIH,MAAgB,SAClBG,IAAUJ,IAAS,WAAW,SACrBC,MAAgB,UACzBG,IAAUJ,IAAS,eAAe,gBACzBC,MAAgB,UACzBG,IAAUJ,IAAS,eAAe,gBAElCI,IAAUJ,IAAS,YAAY;AAIjC,UAAMK,IAAeT;AACrBC,IAAAA,EAAQG,CAAM,GACVf,EAAQqB,WAASC,aAAatB,EAAQqB,OAAO,GAEjDrB,EAAQqB,UAAUE,WAAW,MAAM;AACjCX,MAAAA,EAAQQ,CAAY;AAAA,IACtB,GAAG,GAAI;AAEP,QAAI;AAEF,YAAMvB,EAAOsB,QAAQA,CAAO,EAAA,GACxBnB,EAAQqB,WAASC,aAAatB,EAAQqB,OAAO,GACjDrB,EAAQqB,UAAU;AAAA,IACpB,SAASG,GAAK;AACZC,cAAQC,MAAM,yBAAyBF,CAAG,GACtCxB,EAAQqB,WAASC,aAAatB,EAAQqB,OAAO,GACjDrB,EAAQqB,UAAU,MAClBT,EAAQQ,CAAY;AAAA,IACtB;AAAA,EACF;AAEAO,SAAAA,EAAU,MAAM;AACd,IAAI3B,EAAQqB,WAAWV,OAAUd,EAAOU,UAAUE,MAClDG,EAAQf,EAAOU,UAAUE,CAAE;AAAA,EAC7B,GAAG,CAACZ,EAAOU,OAAOI,CAAI,CAAC,GAGrB,gBAAAiB,EAAC7C,KAAQ,WAAW,sBAAsBe,CAAS,IAAI,GAAIC,GACxDS,UAAAA,IACC,gBAAAoB;AAAA,IAAClC;AAAA,IAAA;AAAA,MACC,UAAUW;AAAAA,MACV,SAASM;AAAAA,MACT,WAAW,GAAGA,IAAO,YAAY,EAAE;AAAA,MAEnC,SAAQ;AAAA,MACR,UAAS;AAAA,MACT,aAAa;AAAA,MACb,eAAe;AAAA,MACf,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,UAAU,MAAMG,EAAaH,CAAAA,CAAmB;AAAA,IAAA;AAAA,EAAA,sBAGjD,OAAA,EAAI,WAAU,gBAAgBT,UAAAA,EAAU2B,WAAWhC,CAAM,EAAA,CAAE,EAAA,CAEhE;AAEJ;"}