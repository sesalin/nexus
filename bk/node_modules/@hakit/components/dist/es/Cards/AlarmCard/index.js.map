{"version":3,"file":"index.js","sources":["../../../../src/Cards/AlarmCard/index.tsx"],"sourcesContent":["import styled from \"@emotion/styled\";\nimport { useMemo, useCallback, type ReactNode } from \"react\";\nimport {\n  localize,\n  useHass,\n  type LocaleKeys,\n  type AlarmMode,\n  type HassEntityWithService,\n  UNAVAILABLE,\n  type EntityName,\n  type FilterByDomain,\n  useEntity,\n  type AlarmPanelCardConfigState,\n} from \"@hakit/core\";\nimport type { AlarmControlsProps, AvailableQueries } from \"@components\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport { fallback } from \"../../Shared/ErrorBoundary\";\nimport {\n  _getActionLabel,\n  _getActionColor,\n  ALARM_MODES,\n  ALARM_MODE_STATE_MAP,\n  filterSupportedAlarmStates,\n  DEFAULT_STATES,\n} from \"../../Shared/Entity/Alarm/AlarmControls/shared\";\nimport { snakeCase } from \"lodash\";\nimport { FeatureEntity } from \"../CardBase/FeatureEntity\";\nimport { ButtonCard, type ButtonCardProps } from \"../ButtonCard\";\n\ntype OmitProperties = \"title\" | \"entity\" | \"as\";\ntype Extendable<E extends FilterByDomain<EntityName, \"alarm_control_panel\">> = Omit<ButtonCardProps<E>, OmitProperties>;\nexport interface AlarmCardProps<E extends FilterByDomain<EntityName, \"alarm_control_panel\">> extends Extendable<E> {\n  /** the alarm entity to control */\n  entity: E;\n  /** overwrite the default actions that are displayed, by default it will show what's supported by the entity */\n  states?: AlarmControlsProps[\"states\"];\n  /** title used in the card for the name of the entity and the modal  */\n  title?: ReactNode;\n  /** default code for the feature buttons to appear, this does not flow throw to the modal, to use the default code in the modal use modalProps.defaultCode @default undefined */\n  defaultCode?: number;\n}\n\ntype AlarmServices = keyof HassEntityWithService<\"alarm_control_panel\">[\"service\"];\n\nconst Wrapper = styled(ButtonCard)``;\n\nconst ALARM_STATE_TO_MODE_MAP: Record<AlarmMode | \"disarm\", LocaleKeys> = {\n  armed_home: \"armed\",\n  armed_away: \"arm_away\",\n  armed_night: \"arm_night\",\n  armed_vacation: \"arm_vacation\",\n  armed_custom_bypass: \"custom_bypass\",\n  disarmed: \"disarmed\",\n  disarm: \"disarm\",\n  triggered: \"pending\",\n  pending: \"pending\",\n  arming: \"pending\",\n};\n\nfunction InternalAlarmCard<E extends FilterByDomain<EntityName, \"alarm_control_panel\">>({\n  entity: _entity,\n  cssStyles,\n  key,\n  className,\n  title: _title,\n  states: _states,\n  modalProps,\n  layoutType = \"slim-vertical\",\n  defaultCode,\n  children,\n  icon: _icon,\n  ...rest\n}: AlarmCardProps<E>) {\n  const entity = useEntity<E>(_entity) as HassEntityWithService<\"alarm_control_panel\">;\n  const globalComponentStyle = useHass((state) => state.globalComponentStyles);\n  const stateLabel = useCallback((state: AlarmMode | \"unavailable\") => {\n    return state === UNAVAILABLE ? localize(\"unavailable\") : localize(ALARM_STATE_TO_MODE_MAP[state]);\n  }, []);\n  const title = useMemo(() => _title ?? entity.attributes.friendly_name, [_title, entity.attributes.friendly_name]);\n  const stateTitle = stateLabel(entity.state);\n  const states = _states || filterSupportedAlarmStates(entity, DEFAULT_STATES);\n\n  const _handleActionClick = (state: AlarmPanelCardConfigState | \"disarm\"): void => {\n    if (!defaultCode) return;\n    entity.service[snakeCase(`alarm_${state}`) as AlarmServices]({\n      serviceData: {\n        code: defaultCode.toString(),\n      },\n    });\n  };\n  const color = _getActionColor(entity.state, modalProps?.customActionColor);\n  return (\n    <Wrapper\n      // @ts-expect-error - this is fine, FabCard is hard coded to type of button because of typescript generic shit\n      as=\"div\"\n      key={key}\n      entity={_entity}\n      layoutType={layoutType}\n      icon={_icon ?? (entity.state in ALARM_MODES ? ALARM_MODES[entity.state].icon : undefined)}\n      // purposely using _title here as we don't want to render the entity title twice\n      title={_title}\n      hideToggle\n      className={`alarm-card ${className ?? \"\"} ${entity.state}`}\n      fabProps={{\n        style: {\n          backgroundColor: color,\n          color: `var(--ha-S500-contrast)`,\n          // now set the hover/disabled states\n        },\n      }}\n      cssStyles={`\n          .fab-card-inner.icon {\n            background-color: ${color};\n            color: var(--ha-S500-contrast);\n          }\n          &:not(.disabled),\n          &:not(:disabled) {\n            &:not(:focus):hover {\n              .fab-card-inner.icon {\n                background-color: ${color};\n                color: var(--ha-S500-contrast);\n              }\n            }\n          }\n          ${globalComponentStyle.alarmCard ?? \"\"}\n          ${cssStyles ?? \"\"}\n        `}\n      features={\n        !defaultCode\n          ? []\n          : (entity.state === \"disarmed\" ? states : ([\"disarm\"] as const)).map((state, index) => (\n              <FeatureEntity\n                key={index}\n                entity={_entity}\n                // @ts-expect-error - no need to type this here\n                onClick={() => {\n                  _handleActionClick(state);\n                }}\n                icon={state in ALARM_MODE_STATE_MAP ? ALARM_MODES[ALARM_MODE_STATE_MAP[state]].icon : undefined}\n              >\n                {_getActionLabel(state, modalProps?.labelMap)}\n              </FeatureEntity>\n            ))\n      }\n      disableActiveState\n      modalProps={{\n        title: title,\n        stateTitle,\n        states,\n        ...modalProps,\n      }}\n      {...rest}\n    >\n      {children}\n    </Wrapper>\n  );\n}\n\n/**\n The AlarmCard is a wrapper for the ButtonCard which automates the \"features\" at the bottom of the card when there's a defaultCode added to the entity.\n Long pressing on the card will open the popup which will include a keypad to enter in the security code\n * */\nexport function AlarmCard<E extends FilterByDomain<EntityName, \"alarm_control_panel\">>(props: AlarmCardProps<E>) {\n  const defaultColumns: AvailableQueries = {\n    xxs: 12,\n    xs: 6,\n    sm: 6,\n    md: 4,\n    lg: 4,\n    xlg: 3,\n  };\n  return (\n    <ErrorBoundary {...fallback({ prefix: \"AlarmCard\" })}>\n      <InternalAlarmCard {...defaultColumns} {...props} />\n    </ErrorBoundary>\n  );\n}\n"],"names":["Wrapper","_styled","ButtonCard","process","env","NODE_ENV","target","label","ALARM_STATE_TO_MODE_MAP","armed_home","armed_away","armed_night","armed_vacation","armed_custom_bypass","disarmed","disarm","triggered","pending","arming","InternalAlarmCard","entity","_entity","cssStyles","key","className","title","_title","states","_states","modalProps","layoutType","defaultCode","children","icon","_icon","rest","useEntity","globalComponentStyle","useHass","state","globalComponentStyles","stateLabel","useCallback","UNAVAILABLE","localize","useMemo","attributes","friendly_name","stateTitle","filterSupportedAlarmStates","DEFAULT_STATES","_handleActionClick","service","snakeCase","serviceData","code","toString","color","_getActionColor","customActionColor","jsx","ALARM_MODES","undefined","style","backgroundColor","alarmCard","map","index","FeatureEntity","ALARM_MODE_STATE_MAP","_getActionLabel","labelMap","AlarmCard","props","defaultColumns","xxs","xs","sm","md","lg","xlg","ErrorBoundary","fallback","prefix"],"mappings":"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"}