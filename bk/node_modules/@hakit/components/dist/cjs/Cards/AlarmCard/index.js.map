{"version":3,"file":"index.js","sources":["../../../../src/Cards/AlarmCard/index.tsx"],"sourcesContent":["import styled from \"@emotion/styled\";\nimport { useMemo, useCallback, type ReactNode } from \"react\";\nimport {\n  localize,\n  useHass,\n  type LocaleKeys,\n  type AlarmMode,\n  type HassEntityWithService,\n  UNAVAILABLE,\n  type EntityName,\n  type FilterByDomain,\n  useEntity,\n  type AlarmPanelCardConfigState,\n} from \"@hakit/core\";\nimport type { AlarmControlsProps, AvailableQueries } from \"@components\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport { fallback } from \"../../Shared/ErrorBoundary\";\nimport {\n  _getActionLabel,\n  _getActionColor,\n  ALARM_MODES,\n  ALARM_MODE_STATE_MAP,\n  filterSupportedAlarmStates,\n  DEFAULT_STATES,\n} from \"../../Shared/Entity/Alarm/AlarmControls/shared\";\nimport { snakeCase } from \"lodash\";\nimport { FeatureEntity } from \"../CardBase/FeatureEntity\";\nimport { ButtonCard, type ButtonCardProps } from \"../ButtonCard\";\n\ntype OmitProperties = \"title\" | \"entity\" | \"as\";\ntype Extendable<E extends FilterByDomain<EntityName, \"alarm_control_panel\">> = Omit<ButtonCardProps<E>, OmitProperties>;\nexport interface AlarmCardProps<E extends FilterByDomain<EntityName, \"alarm_control_panel\">> extends Extendable<E> {\n  /** the alarm entity to control */\n  entity: E;\n  /** overwrite the default actions that are displayed, by default it will show what's supported by the entity */\n  states?: AlarmControlsProps[\"states\"];\n  /** title used in the card for the name of the entity and the modal  */\n  title?: ReactNode;\n  /** default code for the feature buttons to appear, this does not flow throw to the modal, to use the default code in the modal use modalProps.defaultCode @default undefined */\n  defaultCode?: number;\n}\n\ntype AlarmServices = keyof HassEntityWithService<\"alarm_control_panel\">[\"service\"];\n\nconst Wrapper = styled(ButtonCard)``;\n\nconst ALARM_STATE_TO_MODE_MAP: Record<AlarmMode | \"disarm\", LocaleKeys> = {\n  armed_home: \"armed\",\n  armed_away: \"arm_away\",\n  armed_night: \"arm_night\",\n  armed_vacation: \"arm_vacation\",\n  armed_custom_bypass: \"custom_bypass\",\n  disarmed: \"disarmed\",\n  disarm: \"disarm\",\n  triggered: \"pending\",\n  pending: \"pending\",\n  arming: \"pending\",\n};\n\nfunction InternalAlarmCard<E extends FilterByDomain<EntityName, \"alarm_control_panel\">>({\n  entity: _entity,\n  cssStyles,\n  key,\n  className,\n  title: _title,\n  states: _states,\n  modalProps,\n  layoutType = \"slim-vertical\",\n  defaultCode,\n  children,\n  icon: _icon,\n  ...rest\n}: AlarmCardProps<E>) {\n  const entity = useEntity<E>(_entity) as HassEntityWithService<\"alarm_control_panel\">;\n  const globalComponentStyle = useHass((state) => state.globalComponentStyles);\n  const stateLabel = useCallback((state: AlarmMode | \"unavailable\") => {\n    return state === UNAVAILABLE ? localize(\"unavailable\") : localize(ALARM_STATE_TO_MODE_MAP[state]);\n  }, []);\n  const title = useMemo(() => _title ?? entity.attributes.friendly_name, [_title, entity.attributes.friendly_name]);\n  const stateTitle = stateLabel(entity.state);\n  const states = _states || filterSupportedAlarmStates(entity, DEFAULT_STATES);\n\n  const _handleActionClick = (state: AlarmPanelCardConfigState | \"disarm\"): void => {\n    if (!defaultCode) return;\n    entity.service[snakeCase(`alarm_${state}`) as AlarmServices]({\n      serviceData: {\n        code: defaultCode.toString(),\n      },\n    });\n  };\n  const color = _getActionColor(entity.state, modalProps?.customActionColor);\n  return (\n    <Wrapper\n      // @ts-expect-error - this is fine, FabCard is hard coded to type of button because of typescript generic shit\n      as=\"div\"\n      key={key}\n      entity={_entity}\n      layoutType={layoutType}\n      icon={_icon ?? (entity.state in ALARM_MODES ? ALARM_MODES[entity.state].icon : undefined)}\n      // purposely using _title here as we don't want to render the entity title twice\n      title={_title}\n      hideToggle\n      className={`alarm-card ${className ?? \"\"} ${entity.state}`}\n      fabProps={{\n        style: {\n          backgroundColor: color,\n          color: `var(--ha-S500-contrast)`,\n          // now set the hover/disabled states\n        },\n      }}\n      cssStyles={`\n          .fab-card-inner.icon {\n            background-color: ${color};\n            color: var(--ha-S500-contrast);\n          }\n          &:not(.disabled),\n          &:not(:disabled) {\n            &:not(:focus):hover {\n              .fab-card-inner.icon {\n                background-color: ${color};\n                color: var(--ha-S500-contrast);\n              }\n            }\n          }\n          ${globalComponentStyle.alarmCard ?? \"\"}\n          ${cssStyles ?? \"\"}\n        `}\n      features={\n        !defaultCode\n          ? []\n          : (entity.state === \"disarmed\" ? states : ([\"disarm\"] as const)).map((state, index) => (\n              <FeatureEntity\n                key={index}\n                entity={_entity}\n                // @ts-expect-error - no need to type this here\n                onClick={() => {\n                  _handleActionClick(state);\n                }}\n                icon={state in ALARM_MODE_STATE_MAP ? ALARM_MODES[ALARM_MODE_STATE_MAP[state]].icon : undefined}\n              >\n                {_getActionLabel(state, modalProps?.labelMap)}\n              </FeatureEntity>\n            ))\n      }\n      disableActiveState\n      modalProps={{\n        title: title,\n        stateTitle,\n        states,\n        ...modalProps,\n      }}\n      {...rest}\n    >\n      {children}\n    </Wrapper>\n  );\n}\n\n/**\n The AlarmCard is a wrapper for the ButtonCard which automates the \"features\" at the bottom of the card when there's a defaultCode added to the entity.\n Long pressing on the card will open the popup which will include a keypad to enter in the security code\n * */\nexport function AlarmCard<E extends FilterByDomain<EntityName, \"alarm_control_panel\">>(props: AlarmCardProps<E>) {\n  const defaultColumns: AvailableQueries = {\n    xxs: 12,\n    xs: 6,\n    sm: 6,\n    md: 4,\n    lg: 4,\n    xlg: 3,\n  };\n  return (\n    <ErrorBoundary {...fallback({ prefix: \"AlarmCard\" })}>\n      <InternalAlarmCard {...defaultColumns} {...props} />\n    </ErrorBoundary>\n  );\n}\n"],"names":["Wrapper","_styled","ButtonCard","process","env","NODE_ENV","target","label","ALARM_STATE_TO_MODE_MAP","armed_home","armed_away","armed_night","armed_vacation","armed_custom_bypass","disarmed","disarm","triggered","pending","arming","InternalAlarmCard","entity","_entity","cssStyles","key","className","title","_title","states","_states","modalProps","layoutType","defaultCode","children","icon","_icon","rest","useEntity","globalComponentStyle","useHass","state","globalComponentStyles","stateLabel","useCallback","UNAVAILABLE","localize","useMemo","attributes","friendly_name","stateTitle","filterSupportedAlarmStates","DEFAULT_STATES","_handleActionClick","service","snakeCase","serviceData","code","toString","color","_getActionColor","customActionColor","jsx","ALARM_MODES","undefined","style","backgroundColor","alarmCard","map","index","FeatureEntity","ALARM_MODE_STATE_MAP","_getActionLabel","labelMap","AlarmCard","props","defaultColumns","xxs","xs","sm","md","lg","xlg","ErrorBoundary","fallback","prefix"],"mappings":"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"}