{"version":3,"file":"Marquee.js","sources":["../../../../src/Cards/MediaPlayerCard/Marquee.tsx"],"sourcesContent":["import {\n  Fragment,\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useMemo,\n  ReactNode,\n  CSSProperties,\n  FC,\n  forwardRef,\n  Children,\n  RefAttributes,\n  RefObject,\n} from \"react\";\nimport styled from \"@emotion/styled\";\n\nconst StyledMarquee = styled.div`\n  overflow-x: hidden !important;\n  display: flex !important;\n  flex-direction: row !important;\n  position: relative;\n  width: var(--ha-marquee-width);\n  transform: var(--ha-marquee-transform);\n\n  &:hover div {\n    animation-play-state: var(--ha-marquee-pause-on-hover);\n  }\n\n  &:active div {\n    animation-play-state: var(--ha-marquee-pause-on-click);\n  }\n\n  .overlay {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n\n    &::before,\n    &::after {\n      background: linear-gradient(to right, var(--ha-marquee-gradient-color));\n      content: \"\";\n      height: 100%;\n      position: absolute;\n      width: var(--ha-marquee-gradient-width);\n      z-index: 2;\n    }\n\n    &::after {\n      right: 0;\n      top: 0;\n      transform: rotateZ(180deg);\n    }\n\n    &::before {\n      left: 0;\n      top: 0;\n    }\n  }\n\n  .marquee {\n    flex: 0 0 auto;\n    min-width: var(--ha-marquee-min-width);\n    z-index: 1;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    animation: scroll var(--ha-marquee-duration) linear var(--ha-marquee-delay) var(--ha-marquee-iteration-count);\n    animation-play-state: var(--ha-marquee-play);\n    animation-delay: var(--ha-marquee-delay);\n    animation-direction: var(--ha-marquee-direction);\n\n    @keyframes scroll {\n      0% {\n        transform: translateX(0%);\n      }\n      100% {\n        transform: translateX(-100%);\n      }\n    }\n  }\n\n  .initial-child-container {\n    flex: 0 0 auto;\n    display: flex;\n    min-width: auto;\n    flex-direction: row;\n  }\n\n  .child {\n    transform: var(--ha-marquee-transform);\n    &.last-child {\n      padding-right: var(--ha-marquee-padding-right);\n    }\n  }\n`;\n\nexport type MarqueeProps = {\n  /**\n   * @description Inline style for the container div\n   * @type {CSSProperties}\n   * @default {}\n   */\n  style?: CSSProperties;\n  /**\n   * @description Class name to style the container div\n   * @type {string}\n   * @default \"\"\n   */\n  className?: string;\n  /**\n   * @description Whether to automatically fill blank space in the marquee with copies of the children or not\n   * @type {boolean}\n   * @default false\n   */\n  autoFill?: boolean;\n  /**\n   * @description Whether to play or pause the marquee\n   * @type {boolean}\n   * @default true\n   */\n  play?: boolean;\n  /**\n   * @description Whether to pause the marquee when hovered\n   * @type {boolean}\n   * @default false\n   */\n  pauseOnHover?: boolean;\n  /**\n   * @description Whether to pause the marquee when clicked\n   * @type {boolean}\n   * @default false\n   */\n  pauseOnClick?: boolean;\n  /**\n   * @description The direction the marquee is sliding\n   * @type {\"left\" | \"right\" | \"up\" | \"down\"}\n   * @default \"left\"\n   */\n  direction?: \"left\" | \"right\" | \"up\" | \"down\";\n  /**\n   * @description Speed calculated as pixels/second\n   * @type {number}\n   * @default 50\n   */\n  speed?: number;\n  /**\n   * @description Duration to delay the animation after render, in seconds\n   * @type {number}\n   * @default 0\n   */\n  delay?: number;\n  /**\n   * @description The number of times the marquee should loop, 0 is equivalent to infinite\n   * @type {number}\n   * @default 0\n   */\n  loop?: number;\n  /**\n   * @description Whether to show the gradient or not\n   * @type {boolean}\n   * @default false\n   */\n  gradient?: boolean;\n  /**\n   * @description The rgb color of the gradient as an array of length 3\n   * @type {Array<number>} of length 3\n   * @default [255, 255, 255]\n   */\n  gradientColor?: [number, number, number];\n  /**\n   * @description The width of the gradient on either side\n   * @type {number | string}\n   * @default 200\n   */\n  gradientWidth?: number | string;\n  /**\n   * @description A callback for when the marquee finishes scrolling and stops. Only calls if loop is non-zero.\n   * @type {() => void}\n   * @default null\n   */\n  onFinish?: () => void;\n  /**\n   * @description A callback for when the marquee finishes a loop. Does not call if maximum loops are reached (use onFinish instead).\n   * @type {() => void}\n   * @default null\n   */\n  onCycleComplete?: () => void;\n  /**\n   * @description: A callback function that is invoked once the marquee has finished mounting. It can be utilized to recalculate the page size, if necessary.\n   * @type {() => void}\n   * @default null\n   */\n  onMount?: () => void;\n  /**\n   * @description The children rendered inside the marquee\n   * @type {ReactNode}\n   * @default null\n   */\n  children?: ReactNode;\n} & RefAttributes<HTMLDivElement>;\n\nexport const Marquee: FC<MarqueeProps> = forwardRef(function Marquee(\n  {\n    style = {},\n    className = \"\",\n    autoFill = false,\n    play = true,\n    pauseOnHover = false,\n    pauseOnClick = false,\n    direction = \"left\",\n    speed = 50,\n    delay = 0,\n    loop = 0,\n    gradient = false,\n    gradientColor = [255, 255, 255],\n    gradientWidth = 200,\n    onFinish,\n    onCycleComplete,\n    onMount,\n    children,\n  },\n  ref,\n) {\n  // React Hooks\n  const [containerWidth, setContainerWidth] = useState(0);\n  const [marqueeWidth, setMarqueeWidth] = useState(0);\n  const [multiplier, setMultiplier] = useState(1);\n  const [isMounted, setIsMounted] = useState(false);\n  const rootRef = useRef<HTMLDivElement>(null);\n  const containerRef = (ref as RefObject<HTMLDivElement>) || rootRef;\n  const marqueeRef = useRef<HTMLDivElement>(null);\n  const resizeObserverRef = useRef<ResizeObserver | null>(null);\n  const calculateWidthRef = useRef<() => void>(() => {});\n\n  // Calculate width of container and marquee and set multiplier\n  const calculateWidth = useCallback(() => {\n    if (marqueeRef.current && containerRef.current) {\n      const containerRect = containerRef.current.getBoundingClientRect();\n      const marqueeRect = marqueeRef.current.getBoundingClientRect();\n      let containerWidth = containerRect.width;\n      let marqueeWidth = marqueeRect.width;\n\n      // Swap width and height if direction is up or down\n      if (direction === \"up\" || direction === \"down\") {\n        containerWidth = containerRect.height;\n        marqueeWidth = marqueeRect.height;\n      }\n\n      if (autoFill && containerWidth && marqueeWidth) {\n        setMultiplier(marqueeWidth < containerWidth ? Math.ceil(containerWidth / marqueeWidth) : 1);\n      } else {\n        setMultiplier(1);\n      }\n\n      setContainerWidth(containerWidth);\n      setMarqueeWidth(marqueeWidth);\n    }\n  }, [autoFill, containerRef, direction]);\n\n  useEffect(() => {\n    calculateWidthRef.current = calculateWidth;\n  }, [calculateWidth]);\n\n  // Calculate width and multiplier on mount and on window resize\n  useEffect(() => {\n    if (!isMounted) return;\n\n    // Create the observer exactly once\n    if (!resizeObserverRef.current) {\n      resizeObserverRef.current = new ResizeObserver(() => {\n        calculateWidthRef.current();\n      });\n    }\n    // If refs are available, observe them\n    if (marqueeRef.current && containerRef.current) {\n      resizeObserverRef.current.observe(containerRef.current);\n      resizeObserverRef.current.observe(marqueeRef.current);\n    }\n    return () => {\n      // Cleanup observer on unmount\n      resizeObserverRef.current?.disconnect();\n    };\n  }, [isMounted, containerRef]);\n\n  useEffect(() => {\n    setIsMounted(true);\n    return () => {\n      if (!resizeObserverRef.current) return;\n      resizeObserverRef.current.disconnect();\n    };\n  }, []);\n\n  // Runs the onMount callback, if it is a function, when Marquee is mounted.\n  useEffect(() => {\n    if (typeof onMount === \"function\") {\n      onMount();\n    }\n  }, [onMount]);\n\n  // Animation duration\n  const duration = useMemo(() => {\n    if (autoFill) {\n      return (marqueeWidth * multiplier) / speed;\n    } else {\n      return marqueeWidth < containerWidth ? containerWidth / speed : marqueeWidth / speed;\n    }\n  }, [autoFill, containerWidth, marqueeWidth, multiplier, speed]);\n\n  // Gradient color in an unfinished rgba format\n  const rgbaGradientColor = `rgba(${gradientColor[0]}, ${gradientColor[1]}, ${gradientColor[2]}`;\n\n  const containerStyle = useMemo(\n    () => ({\n      ...style,\n      [\"--ha-marquee-pause-on-hover\" as string]: !play || pauseOnHover ? \"paused\" : \"running\",\n      [\"--ha-marquee-pause-on-click\" as string]: !play || (pauseOnHover && !pauseOnClick) || pauseOnClick ? \"paused\" : \"running\",\n      [\"--ha-marquee-width\" as string]: direction === \"up\" || direction === \"down\" ? `100vh` : \"100%\",\n      [\"--ha-marquee-transform\" as string]: direction === \"up\" ? \"rotate(-90deg)\" : direction === \"down\" ? \"rotate(90deg)\" : \"none\",\n    }),\n    [style, play, pauseOnHover, pauseOnClick, direction],\n  );\n\n  const gradientStyle = useMemo(\n    () => ({\n      [\"--ha-marquee-gradient-color\" as string]: `${rgbaGradientColor}, 1), ${rgbaGradientColor}, 0)`,\n      [\"--ha-marquee-gradient-width\" as string]: typeof gradientWidth === \"number\" ? `${gradientWidth}px` : gradientWidth,\n    }),\n    [rgbaGradientColor, gradientWidth],\n  );\n\n  const marqueeStyle = useMemo(\n    () => ({\n      [\"--ha-marquee-play\" as string]: play ? \"running\" : \"paused\",\n      [\"--ha-marquee-direction\" as string]: direction === \"left\" ? \"normal\" : \"reverse\",\n      [\"--ha-marquee-duration\" as string]: `${duration}s`,\n      [\"--ha-marquee-delay\" as string]: `${delay}s`,\n      [\"--ha-marquee-iteration-count\" as string]: loop > 0 ? `${loop}` : \"infinite\",\n      [\"--ha-marquee-min-width\" as string]: autoFill ? `auto` : \"100%\",\n      [\"--ha-marquee-padding-right\" as string]: autoFill ? `4rem` : \"0\",\n    }),\n    [play, direction, duration, delay, loop, autoFill],\n  );\n\n  const childStyle = useMemo(\n    () => ({\n      [\"--ha-marquee-transform\" as string]: direction === \"up\" ? \"rotate(90deg)\" : direction === \"down\" ? \"rotate(-90deg)\" : \"none\",\n    }),\n    [direction],\n  );\n\n  // Render {multiplier} number of children\n  const multiplyChildren = useCallback(\n    (multiplier: number) => {\n      return [...Array(Number.isFinite(multiplier) && multiplier >= 0 ? multiplier : 0)].map((_, i) => (\n        <Fragment key={i}>\n          {Children.map(children, (child, index) => {\n            return (\n              <div style={childStyle} className={`child ${index === Children.toArray(children).length - 1 ? \"last-child\" : \"\"}`}>\n                {child}\n              </div>\n            );\n          })}\n        </Fragment>\n      ));\n    },\n    [childStyle, children],\n  );\n\n  return !isMounted ? null : (\n    <StyledMarquee ref={containerRef} style={containerStyle} className={\"marquee-container \" + className}>\n      {gradient && <div style={gradientStyle} className=\"overlay\" />}\n      <div className=\"marquee\" style={marqueeStyle} onAnimationIteration={onCycleComplete} onAnimationEnd={onFinish}>\n        <div className=\"initial-child-container\" ref={marqueeRef}>\n          {Children.map(children, (child, index) => {\n            return (\n              <div style={childStyle} className={`child ${index === Children.toArray(children).length - 1 ? \"last-child\" : \"\"}`}>\n                {child}\n              </div>\n            );\n          })}\n        </div>\n        {multiplyChildren(multiplier - 1)}\n      </div>\n      <div className=\"marquee\" style={marqueeStyle}>\n        {multiplyChildren(multiplier)}\n      </div>\n    </StyledMarquee>\n  );\n});\n"],"names":["StyledMarquee","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","Marquee","forwardRef","style","className","autoFill","play","pauseOnHover","pauseOnClick","direction","speed","delay","loop","gradient","gradientColor","gradientWidth","onFinish","onCycleComplete","onMount","children","ref","containerWidth","setContainerWidth","useState","marqueeWidth","setMarqueeWidth","multiplier","setMultiplier","isMounted","setIsMounted","rootRef","useRef","containerRef","marqueeRef","resizeObserverRef","calculateWidthRef","calculateWidth","useCallback","current","containerRect","getBoundingClientRect","marqueeRect","width","height","Math","ceil","useEffect","ResizeObserver","observe","disconnect","duration","useMemo","rgbaGradientColor","containerStyle","gradientStyle","marqueeStyle","childStyle","multiplyChildren","Array","Number","isFinite","map","_","i","jsx","Fragment","Children","child","index","toArray","length","jsxs"],"mappings":"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"}