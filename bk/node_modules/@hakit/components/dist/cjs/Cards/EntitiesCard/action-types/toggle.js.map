{"version":3,"file":"toggle.js","sources":["../../../../../src/Cards/EntitiesCard/action-types/toggle.tsx"],"sourcesContent":["import styled from \"@emotion/styled\";\nimport { type EntityName, computeDomain, isUnavailableState, ON, OFF, useHass } from \"@hakit/core\";\nimport { useState, useEffect, useRef } from \"react\";\nimport Switch from \"react-switch\";\nimport { StateProps } from \"./types\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  white-space: nowrap;\n`;\n\nconst StyledSwitch = styled(Switch)`\n  color: var(--ha-100);\n  .react-switch-bg {\n    background: var(--ha-S100) !important;\n  }\n  &.checked {\n    .react-switch-bg {\n      background: var(--ha-A400) !important;\n    }\n  }\n`;\n\nexport default function ToggleState({ entity, className, ...rest }: StateProps) {\n  const timeout = useRef<NodeJS.Timeout | null>(null);\n  const formatter = useHass((store) => store.formatter);\n  const isUnavailable = isUnavailableState(entity.state);\n\n  const showToggle = entity.state === ON || entity.state === OFF || isUnavailable;\n  const [isOn, setIsOn] = useState(entity.state === ON);\n\n  const _callService = async (turnOn: boolean): Promise<void> => {\n    const stateDomain = computeDomain(entity.entity_id as EntityName);\n    let service;\n\n    if (stateDomain === \"lock\") {\n      service = turnOn ? \"unlock\" : \"lock\";\n    } else if (stateDomain === \"cover\") {\n      service = turnOn ? \"open_cover\" : \"close_cover\";\n    } else if (stateDomain === \"valve\") {\n      service = turnOn ? \"open_valve\" : \"close_valve\";\n    } else if (stateDomain === \"group\") {\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    } else {\n      service = turnOn ? \"turn_on\" : \"turn_off\";\n    }\n    const previousIsOn = isOn;\n    setIsOn(turnOn);\n    if (timeout.current) clearTimeout(timeout.current);\n    // wait 2 seconds, if the state hasn't updated, revert the switch\n    timeout.current = setTimeout(() => {\n      setIsOn(previousIsOn);\n    }, 2000);\n\n    try {\n      // @ts-expect-error - this is fine, types are wrong\n      await entity.service[service]();\n      if (timeout.current) clearTimeout(timeout.current);\n      timeout.current = null;\n    } catch (err) {\n      console.error(\"Error calling service\", err);\n      if (timeout.current) clearTimeout(timeout.current);\n      timeout.current = null;\n      setIsOn(previousIsOn);\n    }\n  };\n\n  useEffect(() => {\n    if (timeout.current || isOn === (entity.state === ON)) return;\n    setIsOn(entity.state === ON);\n  }, [entity.state, isOn]);\n\n  return (\n    <Wrapper className={`action-type-toggle ${className}`} {...rest}>\n      {showToggle ? (\n        <StyledSwitch\n          disabled={isUnavailable}\n          checked={isOn}\n          className={`${isOn ? \"checked\" : \"\"}`}\n          // These will not be used, i've only included these so it's clear that they are not used\n          onColor=\"#fff\"\n          offColor=\"#fff\"\n          checkedIcon={false}\n          uncheckedIcon={false}\n          height={20}\n          width={37}\n          onChange={() => _callService(isOn ? false : true)}\n        />\n      ) : (\n        <div className=\"text-content\">{formatter.stateValue(entity)}</div>\n      )}\n    </Wrapper>\n  );\n}\n"],"names":["Wrapper","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","StyledSwitch","Switch","ToggleState","entity","className","rest","timeout","useRef","formatter","useHass","store","isUnavailable","isUnavailableState","state","showToggle","ON","OFF","isOn","setIsOn","useState","_callService","turnOn","stateDomain","computeDomain","entity_id","service","previousIsOn","current","clearTimeout","setTimeout","err","console","error","useEffect","jsx","stateValue"],"mappings":"+jBAMA,MAAMA,EAAOC,EAAAA,aAAA,MAAAC,QAAAC,IAAAC,WAAA,aAAA,CAAAC,OAAA,WAAA,EAAA,CAAAA,OAAA,YAAAC,MAAA,SAAA,CAAA,EAAAJ,QAAAC,IAAAC,WAAA,aAAA,CAAAG,KAAA,UAAAC,OAAA,8EAAA,EAAA,CAAAD,KAAA,UAAAC,OAAA,+EAAAC,SAAAC,CAAA,CAAA,EAOPC,EAAeV,EAAAA,aAAOW,EAAMV,QAAAC,IAAAC,WAAA,aAAA,CAAAC,OAAA,WAAA,EAAA,CAAAA,OAAA,YAAAC,MAAA,cAAA,CAAA,EAACJ,QAAAC,IAAAC,WAAA,aAAA,CAAAG,KAAA,SAAAC,OAAA,6IAAA,EAAA,CAAAD,KAAA,SAAAC,OAAA,8IAAAC,SAAAC,CAAA,CAAA,EAYnC,SAAwBG,EAAY,CAAEC,OAAAA,EAAQC,UAAAA,EAAW,GAAGC,CAAiB,EAAG,CAC9E,MAAMC,EAAUC,EAAAA,OAA8B,IAAI,EAC5CC,EAAYC,EAAAA,QAASC,GAAUA,EAAMF,SAAS,EAC9CG,EAAgBC,EAAAA,mBAAmBT,EAAOU,KAAK,EAE/CC,EAAaX,EAAOU,QAAUE,EAAAA,IAAMZ,EAAOU,QAAUG,EAAAA,KAAOL,EAC5D,CAACM,EAAMC,CAAO,EAAIC,EAAAA,SAAShB,EAAOU,QAAUE,IAAE,EAE9CK,EAAe,MAAOC,GAAmC,CAC7D,MAAMC,EAAcC,EAAAA,cAAcpB,EAAOqB,SAAuB,EAChE,IAAIC,EAEAH,IAAgB,OAClBG,EAAUJ,EAAS,SAAW,OACrBC,IAAgB,QACzBG,EAAUJ,EAAS,aAAe,cACzBC,IAAgB,QACzBG,EAAUJ,EAAS,aAAe,cAElCI,EAAUJ,EAAS,UAAY,WAIjC,MAAMK,EAAeT,EACrBC,EAAQG,CAAM,EACVf,EAAQqB,SAASC,aAAatB,EAAQqB,OAAO,EAEjDrB,EAAQqB,QAAUE,WAAW,IAAM,CACjCX,EAAQQ,CAAY,CACtB,EAAG,GAAI,EAEP,GAAI,CAEF,MAAMvB,EAAOsB,QAAQA,CAAO,EAAA,EACxBnB,EAAQqB,SAASC,aAAatB,EAAQqB,OAAO,EACjDrB,EAAQqB,QAAU,IACpB,OAASG,EAAK,CACZC,QAAQC,MAAM,wBAAyBF,CAAG,EACtCxB,EAAQqB,SAASC,aAAatB,EAAQqB,OAAO,EACjDrB,EAAQqB,QAAU,KAClBT,EAAQQ,CAAY,CACtB,CACF,EAEAO,OAAAA,EAAAA,UAAU,IAAM,CACV3B,EAAQqB,SAAWV,KAAUd,EAAOU,QAAUE,EAAAA,KAClDG,EAAQf,EAAOU,QAAUE,IAAE,CAC7B,EAAG,CAACZ,EAAOU,MAAOI,CAAI,CAAC,EAGrBiB,MAAC7C,GAAQ,UAAW,sBAAsBe,CAAS,GAAI,GAAIC,EACxDS,SAAAA,EACCoB,EAAAA,IAAClC,EAAA,CACC,SAAUW,EACV,QAASM,EACT,UAAW,GAAGA,EAAO,UAAY,EAAE,GAEnC,QAAQ,OACR,SAAS,OACT,YAAa,GACb,cAAe,GACf,OAAQ,GACR,MAAO,GACP,SAAU,IAAMG,EAAaH,CAAAA,CAAmB,CAAA,CAAA,QAGjD,MAAA,CAAI,UAAU,eAAgBT,SAAAA,EAAU2B,WAAWhC,CAAM,CAAA,CAAE,CAAA,CAEhE,CAEJ"}