{"version":3,"file":"TextField.js","sources":["../../../../src/Shared/Form/TextField.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\nimport { Icon } from \"@iconify/react\";\nimport styled from \"@emotion/styled\";\nimport { useHass } from \"@hakit/core\";\n\nexport interface TextFieldProps extends React.ComponentPropsWithoutRef<\"div\"> {\n  type?: string;\n  value?: string;\n  errorMessage?: string;\n  label?: string;\n  placeholder?: string;\n  leadingIcon?: string;\n  trailingIcon?: string;\n  minLength?: number;\n  maxLength?: number;\n  min?: number;\n  max?: number;\n  helperText?: string;\n  charCounter?: boolean;\n  disabled?: boolean;\n  inputProps?: React.ComponentPropsWithoutRef<\"input\">;\n}\n\nconst TextFieldBase = styled.div`\n  --padding-horizontal: 14px;\n  --padding-horizontal-icon: 8px;\n  --padding-vertical: 16px;\n  --floating-label-padding-horizontal: 4px;\n  --margin-vertical: 16px;\n  --transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1);\n  --transition-duration: 0.4s;\n  --border-width: 1px;\n  --border-width-active: 2px;\n  --icon-size: 24px;\n  --icon-margin: 12px;\n  --border-radius: 4px;\n  --font-size: 16;\n  --label-font-size-active: 12;\n  --label-scale-factor: calc(var(--label-font-size-active) / var(--font-size));\n  --label-scale-width: calc((100% - var(--padding-horizontal) * 2 - var(--floating-label-padding-horizontal)) / var(--label-scale-factor));\n\n  margin: var(--margin-vertical) 0;\n\n  &:disabled,\n  &.disabled {\n    cursor: not-allowed;\n    opacity: 0.8;\n  }\n\n  .field-wrapper {\n    align-items: center;\n    display: flex;\n    flex-direction: row;\n    position: relative;\n  }\n\n  .field-wrapper input,\n  .field-wrapper label {\n    font-size: calc(var(--font-size) * 1px);\n  }\n\n  .field-wrapper input {\n    background: transparent;\n    border: none;\n    color: var(--ha-S200-contrast);\n    padding: var(--padding-vertical) var(--padding-horizontal);\n    outline: none;\n    width: 100%;\n  }\n\n  .field-wrapper input:-moz-ui-invalid {\n    box-shadow: none !important;\n  }\n\n  .field-wrapper i {\n    color: var(--ha-S200-contrast);\n    margin: 0 var(--icon-margin);\n    pointer-events: none;\n    width: var(--icon-size);\n  }\n\n  .field-wrapper label {\n    color: var(--ha-S400-contrast);\n    pointer-events: none;\n  }\n\n  .field-wrapper label.floating {\n    left: var(--padding-horizontal);\n    line-height: calc((var(--label-font-size-active) * 1px) * 1.45);\n    max-width: calc(100% - var(--padding-horizontal) * 2);\n    overflow: hidden;\n    position: absolute;\n    text-overflow: ellipsis;\n    transition-duration: var(--transition-duration);\n    transform-origin: 0 0;\n    transition-property: color, font-size, padding, transform, max-width, left;\n    transition-timing-function: var(--transition-timing-function);\n    white-space: nowrap;\n  }\n\n  .field-wrapper label.reference {\n    max-width: var(--label-scale-width);\n    padding: 0 var(--floating-label-padding-horizontal) 0 0;\n    transform: scale3d(var(--label-scale-factor), var(--label-scale-factor), 1);\n  }\n\n  .field-wrapper._leading-icon,\n  .field-wrapper._trailing-icon label.floating:not(.reference) {\n    max-width: calc(100% - var(--icon-size) + (var(--icon-margin) * 2) + var(--padding-horizontal));\n  }\n\n  .field-wrapper._leading-icon._trailing-icon label.floating:not(.reference) {\n    max-width: calc(100% - ((var(--icon-size) + (var(--icon-margin) * 2)) * 2));\n  }\n\n  .field-wrapper._leading-icon input {\n    padding-left: 0;\n  }\n\n  .field-wrapper._leading-icon label.floating:not(.reference) {\n    left: calc(var(--icon-size) + (var(--icon-margin) * 2));\n  }\n\n  .field-wrapper._trailing-icon input {\n    padding-right: 0;\n  }\n\n  .borders {\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n    pointer-events: none;\n    position: absolute;\n    width: 100%;\n  }\n\n  .borders .border {\n    border-color: var(--ha-S300);\n    border-style: solid;\n    transition-duration: var(--transition-duration);\n    transition-property: border-color, width;\n    transition-timing-function: var(--transition-timing-function);\n  }\n\n  .borders .middle {\n    display: flex;\n    flex: 1 1 auto;\n    flex-direction: column;\n  }\n\n  .borders .middle .top-borders {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n  }\n\n  .borders .middle .top-borders .border {\n    border-width: var(--border-width) 0 0;\n    flex: unset;\n  }\n\n  .borders .middle .top-borders .border.start {\n    width: calc(var(--label-active-width) / 2);\n  }\n\n  .borders .middle .border {\n    flex: 1 1 auto;\n    width: 100%;\n  }\n\n  .borders .middle .border.bottom {\n    border-width: 0 0 var(--border-width) 0;\n  }\n\n  .borders .left,\n  .borders .right {\n    width: calc(var(--padding-horizontal) - var(--floating-label-padding-horizontal) - var(--border-width));\n  }\n\n  .borders .left {\n    border-radius: var(--border-radius) 0 0 var(--border-radius);\n    border-width: var(--border-width) 0 var(--border-width) var(--border-width);\n  }\n\n  .borders .right {\n    border-radius: 0 var(--border-radius) var(--border-radius) 0;\n    border-width: var(--border-width) var(--border-width) var(--border-width) 0;\n  }\n\n  .field-wrapper._floating-label._focused .borders .top-borders .start,\n  .field-wrapper._floating-label._has-value .borders .top-borders .start {\n    width: 0;\n  }\n\n  .field-wrapper._floating-label._focused .borders .top-borders .end,\n  .field-wrapper._floating-label._has-value .borders .top-borders .end {\n    width: calc(100% - var(--label-active-width, 0) - var(--floating-label-padding-horizontal));\n  }\n\n  .field-wrapper._floating-label._focused label.floating:not(.reference),\n  .field-wrapper._floating-label._has-value label.floating:not(.reference) {\n    left: var(--padding-horizontal);\n    max-width: var(--label-scale-width);\n    padding: 0 var(--floating-label-padding-horizontal) 0 0;\n    transform: translate3d(0, calc(-100% - var(--label-font-size-active) * 0.5px), 0)\n      scale3d(var(--label-scale-factor), var(--label-scale-factor), 1);\n  }\n\n  .field-wrapper._focused label.floating {\n    color: var(--ha-300);\n  }\n\n  .field-wrapper._focused .borders .top-borders .border {\n    border-width: var(--border-width-active) 0 0;\n  }\n\n  .field-wrapper._focused .borders .border {\n    border-color: var(--ha-300);\n  }\n\n  .field-wrapper._focused .borders .border.bottom {\n    border-width: 0 0 var(--border-width-active) 0;\n  }\n\n  .field-wrapper._focused .borders .border.left {\n    border-width: var(--border-width-active) 0 var(--border-width-active) var(--border-width-active);\n  }\n\n  .field-wrapper._focused .borders .border.right {\n    border-width: var(--border-width-active) var(--border-width-active) var(--border-width-active) 0;\n  }\n\n  .field-wrapper._invalid .borders .border {\n    border-color: var(--ha-alert-error-color);\n  }\n\n  .field-wrapper._invalid label.floating {\n    color: var(--ha-alert-error-color);\n  }\n\n  .hints {\n    color: var(--ha-S400-contrast);\n    display: flex;\n    flex-direction: row;\n    font-size: 12px;\n    margin: 4px 12px 0 12px;\n  }\n\n  .hints .messages {\n    flex: 1 1 auto;\n  }\n\n  .hints .error {\n    color: var(--ha-alert-error-color);\n  }\n\n  .hints .char-counter {\n    margin: 0 0 0 12px;\n  }\n`;\n\nexport const TextField: React.FC<TextFieldProps> = ({\n  type = \"text\",\n  value: initialValue = \"\",\n  errorMessage: initialErrorMessage = null,\n  label,\n  placeholder,\n  leadingIcon,\n  trailingIcon,\n  minLength,\n  maxLength,\n  min,\n  max,\n  helperText,\n  charCounter,\n  inputProps,\n  className,\n  disabled,\n  ...rest\n}) => {\n  const windowContext = useHass((store) => store.windowContext);\n  const win = windowContext ?? window;\n  const [focused, setFocused] = useState(false);\n  const [value, setValue] = useState<string | null>(initialValue);\n  const [errorMessage, setErrorMessage] = useState<string | null>(initialErrorMessage);\n  const [valid, setValid] = useState(true);\n\n  const container = useRef<HTMLDivElement>(null);\n  const floatingLabelRef = useRef<HTMLLabelElement>(null);\n  const inputField = useRef<HTMLInputElement>(null);\n\n  const setLabelWidthStyleProperty = () => {\n    if (floatingLabelRef.current && container.current) {\n      const dims = floatingLabelRef.current.getBoundingClientRect();\n      container.current.style.setProperty(\"--label-active-width\", `${dims.width}px`);\n    } else if (container.current) {\n      container.current.style.setProperty(\"--label-active-width\", \"0px\");\n    }\n  };\n\n  useEffect(() => {\n    setLabelWidthStyleProperty();\n    win.addEventListener(\"resize\", setLabelWidthStyleProperty);\n    return () => {\n      win.removeEventListener(\"resize\", setLabelWidthStyleProperty);\n    };\n  }, [win]);\n\n  const focusField = () => {\n    inputField.current?.focus();\n  };\n\n  const onFocus = () => {\n    setFocused(true);\n    setLabelWidthStyleProperty();\n  };\n\n  const onBlur = () => {\n    setFocused(false);\n  };\n\n  const updateValue = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setValue(e.target.value);\n    updateValidity();\n  };\n\n  const updateValidity = () => {\n    if (!inputField.current) return;\n    setValid(inputField.current.checkValidity());\n  };\n\n  const getStyleClasses = () => {\n    const classes = [];\n    if (label) classes.push(\"_floating-label\");\n    if (leadingIcon) classes.push(\"_leading-icon\");\n    if (trailingIcon) classes.push(\"_trailing-icon\");\n    if (!valid) classes.push(\"_invalid\");\n    if (value) classes.push(\"_has-value\");\n    if (focused) classes.push(\"_focused\");\n    if (disabled) classes.push(\"disabled\");\n    return classes.join(\" \");\n  };\n\n  const showHintContainer = () => {\n    return errorMessage || helperText || charCounter;\n  };\n\n  const setError = (errorMessage: string) => {\n    if (!inputField.current) return;\n    inputField.current.setCustomValidity(errorMessage);\n    setValid(false);\n    setErrorMessage(errorMessage);\n  };\n\n  useEffect(() => {\n    setValue(initialValue);\n  }, [initialValue]);\n\n  useEffect(() => {\n    if (!valid) {\n      setError(\"This field is required\");\n    }\n  }, [valid]);\n\n  return (\n    <TextFieldBase className={`outline-input ${className ?? \"\"}`} {...rest} ref={container}>\n      <div className={`field-wrapper ${getStyleClasses()}`} onClick={focusField}>\n        {label ? <label className=\"floating\">{label}</label> : null}\n        {label ? (\n          <label\n            ref={floatingLabelRef}\n            className=\"floating reference\"\n            style={{ opacity: 0, pointerEvents: \"none\", visibility: \"hidden\", zIndex: -9999999999 }}\n          >\n            {label}\n          </label>\n        ) : null}\n        {leadingIcon ? (\n          <Icon\n            className={\"icon leading\"}\n            icon={leadingIcon}\n            style={{\n              color: `var(--ha-500-contrast)`,\n            }}\n          />\n        ) : null}\n        <input\n          ref={inputField}\n          type={type}\n          minLength={minLength}\n          maxLength={maxLength}\n          min={min}\n          max={max}\n          placeholder={focused && label ? placeholder : placeholder}\n          value={value || \"\"}\n          onChange={updateValue}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          disabled={disabled}\n          {...inputProps}\n        />\n        {trailingIcon ? (\n          <Icon\n            className={\"icon trailing\"}\n            icon={trailingIcon}\n            style={{\n              color: `var(--ha-500-contrast)`,\n            }}\n          />\n        ) : null}\n        <div className=\"borders\">\n          <div className=\"border left\" />\n          <div className=\"middle\">\n            <div className=\"top-borders\">\n              <div className=\"border start\" />\n              <div className=\"border end\" />\n            </div>\n            <div className=\"border bottom\" />\n          </div>\n          <div className=\"border right\" />\n        </div>\n      </div>\n      {showHintContainer() ? (\n        <div className=\"hints\">\n          {errorMessage || helperText ? (\n            <div className=\"messages\">\n              {!valid && errorMessage ? <div className=\"error\">{errorMessage}</div> : null}\n              {valid && helperText ? <div className=\"helper\">{helperText}</div> : null}\n            </div>\n          ) : null}\n          {maxLength ? (\n            <div className=\"char-counter\">\n              {value ? value.length : 0}/{maxLength}\n            </div>\n          ) : null}\n        </div>\n      ) : null}\n    </TextFieldBase>\n  );\n};\n"],"names":["TextFieldBase","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","TextField","type","value","initialValue","errorMessage","initialErrorMessage","placeholder","leadingIcon","trailingIcon","minLength","maxLength","min","max","helperText","charCounter","inputProps","className","disabled","rest","win","useHass","store","windowContext","window","focused","setFocused","useState","setValue","setErrorMessage","valid","setValid","container","useRef","floatingLabelRef","inputField","setLabelWidthStyleProperty","current","dims","getBoundingClientRect","style","setProperty","width","useEffect","addEventListener","removeEventListener","focusField","focus","onFocus","onBlur","updateValue","e","updateValidity","checkValidity","getStyleClasses","classes","push","join","showHintContainer","setError","setCustomValidity","jsxs","jsx","opacity","pointerEvents","visibility","zIndex","Icon","color","length"],"mappings":"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"}