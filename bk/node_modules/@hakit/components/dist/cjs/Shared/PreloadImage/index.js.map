{"version":3,"file":"index.js","sources":["../../../../src/Shared/PreloadImage/index.tsx"],"sourcesContent":["import { useEffect, useRef, useCallback } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { css } from \"@emotion/react\";\n\nimport { Icon } from \"@iconify/react\";\n\nconst Preloader = styled.div`\n  position: relative;\n`;\n\nconst PreloaderBackground = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  transition-property: background-image, opacity;\n  opacity: 0;\n`;\nconst StyledIcon = styled(Icon)`\n  opacity: 0;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 2rem;\n`;\nexport interface PreloadImageProps extends Omit<React.ComponentPropsWithoutRef<\"div\">, \"onLoad\" | \"onError\"> {\n  lazy?: boolean;\n  src: string;\n  style?: React.CSSProperties;\n  innerStyle?: {\n    backgroundSize?: string;\n    backgroundPosition?: string;\n    backgroundRepeat?: string;\n  };\n  /** duration of the fade in animation in milliseconds */\n  duration?: number;\n  ease?: string;\n  children?: React.ReactNode;\n  onClick?: () => void;\n  onLoad?: () => void;\n  onError?: () => void;\n  onLoading?: () => void;\n}\n\n/** The PreloadImage is a helper component to load an image into the background of the element, this component is pretty generic and requires additional styling to set the width/height of the\n * background image element\n *\n * It will automatically fade in the image once it's loaded, and will show a loading icon while it's loading, everything is pretty configurable and is completely documented\n */\nexport const PreloadImage = ({\n  lazy,\n  src,\n  className,\n  style,\n  innerStyle,\n  duration: _duration,\n  ease,\n  children,\n  onLoad,\n  onLoading,\n  onError,\n  onClick,\n  cssStyles,\n  ...rest\n}: PreloadImageProps) => {\n  const el = useRef<HTMLDivElement>(null);\n  const loadingIconRef = useRef<SVGSVGElement | null>(null);\n  const imageDivRef = useRef<HTMLDivElement | null>(null);\n  const observer = useRef<IntersectionObserver | null>(null);\n  const preloader = useRef<HTMLImageElement | null>(null);\n  const duration = _duration ?? 300;\n\n  const setPreloader = useCallback(() => {\n    if (!src) return;\n    preloader.current = new Image();\n    if (typeof onLoading === \"function\") {\n      onLoading();\n    }\n    if (imageDivRef.current) {\n      imageDivRef.current.style.opacity = \"0\";\n      imageDivRef.current.style.backgroundImage = `url(${src})`;\n    }\n    if (loadingIconRef.current) {\n      loadingIconRef.current.style.opacity = \"1\";\n    }\n\n    preloader.current.onload = () => {\n      if (imageDivRef.current) {\n        imageDivRef.current.style.opacity = \"1\";\n      }\n      if (loadingIconRef.current) {\n        loadingIconRef.current.style.opacity = \"0\";\n      }\n      if (typeof onLoad === \"function\") {\n        onLoad();\n      }\n    };\n    preloader.current.onerror = () => {\n      if (imageDivRef.current) {\n        imageDivRef.current.style.opacity = \"1\";\n      }\n      if (loadingIconRef.current) {\n        loadingIconRef.current.style.opacity = \"0\";\n      }\n      if (typeof onError === \"function\") {\n        onError();\n      }\n    };\n\n    preloader.current.src = src;\n  }, [src, onLoading, onLoad, onError]);\n\n  const setObserver = useCallback(() => {\n    observer.current = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          setPreloader();\n          if (observer.current) observer.current.disconnect();\n        }\n      });\n    });\n\n    if (el.current) observer.current.observe(el.current);\n  }, [setPreloader]);\n\n  useEffect(() => {\n    if (typeof window !== \"undefined\" && lazy && \"IntersectionObserver\" in window) {\n      setObserver();\n    } else {\n      setPreloader();\n    }\n\n    return () => {\n      if (observer.current) observer.current.disconnect();\n      if (preloader.current) preloader.current.onload = null;\n    };\n  }, [lazy, observer, preloader, setObserver, setPreloader]);\n\n  const backgroundSize = innerStyle?.backgroundSize || \"cover\";\n  const backgroundPosition = innerStyle?.backgroundPosition || \"center\";\n  const backgroundRepeat = innerStyle?.backgroundRepeat || \"no-repeat\";\n\n  return (\n    <Preloader\n      css={css`\n        ${cssStyles ?? \"\"}\n      `}\n      className={`preload-image ${className ?? \"\"}`}\n      style={{ ...style }}\n      ref={el}\n      {...rest}\n      onClick={onClick}\n    >\n      <PreloaderBackground\n        className=\"preloader-background-image\"\n        ref={imageDivRef}\n        style={{\n          backgroundSize: backgroundSize,\n          backgroundPosition: backgroundPosition,\n          backgroundRepeat: backgroundRepeat,\n          transitionProperty: \"background-image, opacity\",\n          transitionDuration: `${duration}ms, ${duration}ms`,\n          transitionTimingFunction: `${ease ?? \"cubic-bezier(0.215, 0.61, 0.355, 1)\"}, ${ease ?? \"cubic-bezier(0.215, 0.61, 0.355, 1)\"}`,\n        }}\n      ></PreloaderBackground>\n      <StyledIcon ref={loadingIconRef} icon=\"eos-icons:three-dots-loading\" className=\"preloader-loading-icon\" />\n      {children}\n    </Preloader>\n  );\n};\n"],"names":["Preloader","_styled","process","env","NODE_ENV","target","label","name","styles","toString","_EMOTION_STRINGIFIED_CSS_ERROR__","PreloaderBackground","StyledIcon","Icon","PreloadImage","lazy","src","className","style","innerStyle","duration","_duration","ease","children","onLoad","onLoading","onError","onClick","cssStyles","rest","el","useRef","loadingIconRef","imageDivRef","observer","preloader","setPreloader","useCallback","current","Image","opacity","backgroundImage","onload","onerror","setObserver","IntersectionObserver","entries","forEach","entry","isIntersecting","disconnect","observe","useEffect","window","backgroundSize","backgroundPosition","backgroundRepeat","jsx","transitionProperty","transitionDuration","transitionTimingFunction"],"mappings":"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"}