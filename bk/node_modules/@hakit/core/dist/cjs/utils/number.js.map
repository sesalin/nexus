{"version":3,"file":"number.js","sources":["../../../src/utils/number.ts"],"sourcesContent":["import { HassEntityAttributeBase, HassEntity } from \"home-assistant-js-websocket\";\nimport { EntityRegistryDisplayEntry } from \"./entity_registry\";\n\n/**\n * Checks if the current entity state should be formatted as an integer based on the `state` and `step` attribute and returns the appropriate `Intl.NumberFormatOptions` object with `maximumFractionDigits` set\n * @param entityState The state object of the entity\n * @returns An `Intl.NumberFormatOptions` object with `maximumFractionDigits` set to 0, or `undefined`\n */\nexport const getNumberFormatOptions = (\n  entityState?: HassEntity,\n  entity?: EntityRegistryDisplayEntry,\n): Intl.NumberFormatOptions | undefined => {\n  const precision = entity?.display_precision;\n  if (precision != null) {\n    return {\n      maximumFractionDigits: precision,\n      minimumFractionDigits: precision,\n    };\n  }\n  if (Number.isInteger(Number(entityState?.attributes?.step)) && Number.isInteger(Number(entityState?.state))) {\n    return { maximumFractionDigits: 0 };\n  }\n  return undefined;\n};\n\n/**\n * Returns true if the entity is considered numeric based on the attributes it has\n * @param stateObj The entity state object\n */\nexport const isNumericState = (stateObj: HassEntity): boolean => isNumericFromAttributes(stateObj.attributes);\n\nexport const isNumericFromAttributes = (attributes: HassEntityAttributeBase, numericDeviceClasses?: string[]): boolean =>\n  !!attributes.unit_of_measurement || !!attributes.state_class || (numericDeviceClasses || []).includes(attributes.device_class || \"\");\n\n/**\n * Generates default options for Intl.NumberFormat\n * @param num The number to be formatted\n * @param options The Intl.NumberFormatOptions that should be included in the returned options\n */\nexport const getDefaultFormatOptions = (num: string | number, options?: Intl.NumberFormatOptions): Intl.NumberFormatOptions => {\n  const defaultOptions: Intl.NumberFormatOptions = {\n    maximumFractionDigits: 2,\n    ...options,\n  };\n\n  if (typeof num !== \"string\") {\n    return defaultOptions;\n  }\n\n  // Keep decimal trailing zeros if they are present in a string numeric value\n  if (!options || (options.minimumFractionDigits === undefined && options.maximumFractionDigits === undefined)) {\n    const digits = num.indexOf(\".\") > -1 ? num.split(\".\")[1].length : 0;\n    defaultOptions.minimumFractionDigits = digits;\n    defaultOptions.maximumFractionDigits = digits;\n  }\n\n  return defaultOptions;\n};\n\nexport const round = (value: number, precision = 2): number => Math.round(value * 10 ** precision) / 10 ** precision;\n\n/**\n * Formats a number based on the user's preference with thousands separator(s) and decimal character for better legibility.\n *\n * @param num The number to format\n * @param localeOptions The user-selected language and formatting, from `hass.locale`\n * @param options Intl.NumberFormatOptions to use\n */\nexport const formatNumber = (num: string | number, options?: Intl.NumberFormatOptions): string => {\n  // Polyfill for Number.isNaN, which is more reliable than the global isNaN()\n  Number.isNaN =\n    Number.isNaN ||\n    function isNaN(input): boolean {\n      return typeof input === \"number\" && isNaN(input);\n    };\n\n  if (!Number.isNaN(Number(num)) && num !== \"\") {\n    // If NumberFormat is none, use en-US format without grouping.\n    return new Intl.NumberFormat(\n      \"en-US\",\n      getDefaultFormatOptions(num, {\n        ...options,\n        useGrouping: false,\n      }),\n    ).format(Number(num));\n  }\n\n  if (typeof num === \"string\") {\n    return num;\n  }\n  return `${round(num, options?.maximumFractionDigits).toString()}${options?.style === \"currency\" ? ` ${options.currency}` : \"\"}`;\n};\n"],"names":["getNumberFormatOptions","entityState","entity","precision","isNumericState","stateObj","isNumericFromAttributes","attributes","numericDeviceClasses","getDefaultFormatOptions","num","options","defaultOptions","digits","round","value","formatNumber","isNaN","input"],"mappings":"gFAQO,MAAMA,EAAyB,CACpCC,EACAC,IACyC,CACzC,MAAMC,EAAYD,GAAQ,kBAC1B,GAAIC,GAAa,KACf,MAAO,CACL,sBAAuBA,EACvB,sBAAuBA,CAAA,EAG3B,GAAI,OAAO,UAAU,OAAOF,GAAa,YAAY,IAAI,CAAC,GAAK,OAAO,UAAU,OAAOA,GAAa,KAAK,CAAC,EACxG,MAAO,CAAE,sBAAuB,CAAA,CAGpC,EAMaG,EAAkBC,GAAkCC,EAAwBD,EAAS,UAAU,EAE/FC,EAA0B,CAACC,EAAqCC,IAC3E,CAAC,CAACD,EAAW,qBAAuB,CAAC,CAACA,EAAW,cAAgBC,GAAwB,CAAA,GAAI,SAASD,EAAW,cAAgB,EAAE,EAOxHE,EAA0B,CAACC,EAAsBC,IAAiE,CAC7H,MAAMC,EAA2C,CAC/C,sBAAuB,EACvB,GAAGD,CAAA,EAGL,GAAI,OAAOD,GAAQ,SACjB,OAAOE,EAIT,GAAI,CAACD,GAAYA,EAAQ,wBAA0B,QAAaA,EAAQ,wBAA0B,OAAY,CAC5G,MAAME,EAASH,EAAI,QAAQ,GAAG,EAAI,GAAKA,EAAI,MAAM,GAAG,EAAE,CAAC,EAAE,OAAS,EAClEE,EAAe,sBAAwBC,EACvCD,EAAe,sBAAwBC,CACzC,CAEA,OAAOD,CACT,EAEaE,EAAQ,CAACC,EAAeZ,EAAY,IAAc,KAAK,MAAMY,EAAQ,IAAMZ,CAAS,EAAI,IAAMA,EAS9Fa,EAAe,CAACN,EAAsBC,KAEjD,OAAO,MACL,OAAO,OACP,SAASM,EAAMC,EAAgB,CAC7B,OAAO,OAAOA,GAAU,UAAYD,EAAMC,CAAK,CACjD,EAEE,CAAC,OAAO,MAAM,OAAOR,CAAG,CAAC,GAAKA,IAAQ,GAEjC,IAAI,KAAK,aACd,QACAD,EAAwBC,EAAK,CAC3B,GAAGC,EACH,YAAa,EAAA,CACd,CAAA,EACD,OAAO,OAAOD,CAAG,CAAC,EAGlB,OAAOA,GAAQ,SACVA,EAEF,GAAGI,EAAMJ,EAAKC,GAAS,qBAAqB,EAAE,UAAU,GAAGA,GAAS,QAAU,WAAa,IAAIA,EAAQ,QAAQ,GAAK,EAAE"}