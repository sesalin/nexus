{"version":3,"file":"convert-light-color.js","sources":["../../../../src/utils/colors/convert-light-color.ts"],"sourcesContent":["import { clamp } from \"lodash\";\n\nconst DEFAULT_MIN_KELVIN = 2700;\nconst DEFAULT_MAX_KELVIN = 6500;\n\nexport const temperature2rgb = (temperature: number): [number, number, number] => {\n  const value = temperature / 100;\n  return [temperatureRed(value), temperatureGreen(value), temperatureBlue(value)];\n};\n\nconst temperatureRed = (temperature: number): number => {\n  if (temperature <= 66) {\n    return 255;\n  }\n  const red = 329.698727446 * (temperature - 60) ** -0.1332047592;\n  return clamp(red, 0, 255);\n};\n\nconst temperatureGreen = (temperature: number): number => {\n  let green: number;\n  if (temperature <= 66) {\n    green = 99.4708025861 * Math.log(temperature) - 161.1195681661;\n  } else {\n    green = 288.1221695283 * (temperature - 60) ** -0.0755148492;\n  }\n  return clamp(green, 0, 255);\n};\n\nconst temperatureBlue = (temperature: number): number => {\n  if (temperature >= 66) {\n    return 255;\n  }\n  if (temperature <= 19) {\n    return 0;\n  }\n  const blue = 138.5177312231 * Math.log(temperature - 10) - 305.0447927307;\n  return clamp(blue, 0, 255);\n};\n\nconst matchMaxScale = (inputColors: number[], outputColors: number[]): number[] => {\n  const maxIn: number = Math.max(...inputColors);\n  const maxOut: number = Math.max(...outputColors);\n  let factor: number;\n  if (maxOut === 0) {\n    factor = 0.0;\n  } else {\n    factor = maxIn / maxOut;\n  }\n  return outputColors.map((value) => Math.round(value * factor));\n};\n\nconst mired2kelvin = (miredTemperature: number) => Math.floor(1000000 / miredTemperature);\n\nconst kelvin2mired = (kelvintTemperature: number) => Math.floor(1000000 / kelvintTemperature);\n\nexport const rgbww2rgb = (\n  rgbww: [number, number, number, number, number],\n  minKelvin?: number,\n  maxKelvin?: number,\n): [number, number, number] => {\n  const [r, g, b, cw, ww] = rgbww;\n  // Calculate color temperature of the white channels\n  const maxMireds: number = kelvin2mired(minKelvin ?? DEFAULT_MIN_KELVIN);\n  const minMireds: number = kelvin2mired(maxKelvin ?? DEFAULT_MAX_KELVIN);\n  const miredRange: number = maxMireds - minMireds;\n  let ctRatio: number;\n  try {\n    ctRatio = ww / (cw + ww);\n  } catch (_error) {\n    console.log(\"Error:\", _error);\n    ctRatio = 0.5;\n  }\n  const colorTempMired = minMireds + ctRatio * miredRange;\n  const colorTempKelvin = colorTempMired ? mired2kelvin(colorTempMired) : 0;\n  const [wR, wG, wB] = temperature2rgb(colorTempKelvin);\n  const whiteLevel = Math.max(cw, ww) / 255;\n\n  // Add the white channels to the rgb channels.\n  const rgb = [r + wR * whiteLevel, g + wG * whiteLevel, b + wB * whiteLevel] as [number, number, number];\n\n  // Match the output maximum value to the input. This ensures the\n  // output doesn't overflow.\n  return matchMaxScale([r, g, b, cw, ww], rgb) as [number, number, number];\n};\n\nexport const rgbw2rgb = (rgbw: [number, number, number, number]): [number, number, number] => {\n  const [r, g, b, w] = rgbw;\n  const rgb = [r + w, g + w, b + w] as [number, number, number];\n  return matchMaxScale([r, g, b, w], rgb) as [number, number, number];\n};\n"],"names":["DEFAULT_MIN_KELVIN","DEFAULT_MAX_KELVIN","temperature2rgb","temperature","value","temperatureRed","temperatureGreen","temperatureBlue","red","clamp","green","blue","matchMaxScale","inputColors","outputColors","maxIn","maxOut","factor","mired2kelvin","miredTemperature","kelvin2mired","kelvintTemperature","rgbww2rgb","rgbww","minKelvin","maxKelvin","r","g","b","cw","ww","maxMireds","minMireds","miredRange","ctRatio","_error","colorTempMired","colorTempKelvin","wR","wG","wB","whiteLevel","rgb","rgbw2rgb","rgbw","w"],"mappings":"0GAEMA,EAAqB,KACrBC,EAAqB,KAEdC,EAAmBC,GAAkD,CAChF,MAAMC,EAAQD,EAAc,IAC5B,MAAO,CAACE,EAAeD,CAAK,EAAGE,EAAiBF,CAAK,EAAGG,EAAgBH,CAAK,CAAC,CAChF,EAEMC,EAAkBF,GAAgC,CACtD,GAAIA,GAAe,GACjB,MAAO,KAET,MAAMK,EAAM,eAAiBL,EAAc,KAAO,aAClD,OAAOM,QAAMD,EAAK,EAAG,GAAG,CAC1B,EAEMF,EAAoBH,GAAgC,CACxD,IAAIO,EACJ,OAAIP,GAAe,GACjBO,EAAQ,cAAgB,KAAK,IAAIP,CAAW,EAAI,eAEhDO,EAAQ,gBAAkBP,EAAc,KAAO,aAE1CM,QAAMC,EAAO,EAAG,GAAG,CAC5B,EAEMH,EAAmBJ,GAAgC,CACvD,GAAIA,GAAe,GACjB,MAAO,KAET,GAAIA,GAAe,GACjB,MAAO,GAET,MAAMQ,EAAO,eAAiB,KAAK,IAAIR,EAAc,EAAE,EAAI,eAC3D,OAAOM,QAAME,EAAM,EAAG,GAAG,CAC3B,EAEMC,EAAgB,CAACC,EAAuBC,IAAqC,CACjF,MAAMC,EAAgB,KAAK,IAAI,GAAGF,CAAW,EACvCG,EAAiB,KAAK,IAAI,GAAGF,CAAY,EAC/C,IAAIG,EACJ,OAAID,IAAW,EACbC,EAAS,EAETA,EAASF,EAAQC,EAEZF,EAAa,IAAKV,GAAU,KAAK,MAAMA,EAAQa,CAAM,CAAC,CAC/D,EAEMC,EAAgBC,GAA6B,KAAK,MAAM,IAAUA,CAAgB,EAElFC,EAAgBC,GAA+B,KAAK,MAAM,IAAUA,CAAkB,EAE/EC,EAAY,CACvBC,EACAC,EACAC,IAC6B,CAC7B,KAAM,CAACC,EAAGC,EAAGC,EAAGC,EAAIC,CAAE,EAAIP,EAEpBQ,EAAoBX,EAAaI,GAAaxB,CAAkB,EAChEgC,EAAoBZ,EAAaK,GAAaxB,CAAkB,EAChEgC,EAAqBF,EAAYC,EACvC,IAAIE,EACJ,GAAI,CACFA,EAAUJ,GAAMD,EAAKC,EACvB,OAASK,EAAQ,CACf,QAAQ,IAAI,SAAUA,CAAM,EAC5BD,EAAU,EACZ,CACA,MAAME,EAAiBJ,EAAYE,EAAUD,EACvCI,EAAkBD,EAAiBlB,EAAakB,CAAc,EAAI,EAClE,CAACE,EAAIC,EAAIC,CAAE,EAAItC,EAAgBmC,CAAe,EAC9CI,EAAa,KAAK,IAAIZ,EAAIC,CAAE,EAAI,IAGhCY,EAAM,CAAChB,EAAIY,EAAKG,EAAYd,EAAIY,EAAKE,EAAYb,EAAIY,EAAKC,CAAU,EAI1E,OAAO7B,EAAc,CAACc,EAAGC,EAAGC,EAAGC,EAAIC,CAAE,EAAGY,CAAG,CAC7C,EAEaC,EAAYC,GAAqE,CAC5F,KAAM,CAAClB,EAAGC,EAAGC,EAAGiB,CAAC,EAAID,EACfF,EAAM,CAAChB,EAAImB,EAAGlB,EAAIkB,EAAGjB,EAAIiB,CAAC,EAChC,OAAOjC,EAAc,CAACc,EAAGC,EAAGC,EAAGiB,CAAC,EAAGH,CAAG,CACxC"}