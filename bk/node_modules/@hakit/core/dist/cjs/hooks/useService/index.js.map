{"version":3,"file":"index.js","sources":["../../../../src/hooks/useService/index.ts"],"sourcesContent":["import { useMemo, useCallback } from \"react\";\nimport { useHass } from \"@core\";\nimport { localize } from \"../useLocale\";\nimport type { SupportedServices, DomainService, SnakeOrCamelDomains, ServiceData, SnakeToCamel, Target } from \"@typings\";\nimport type { HassStore } from \"@core\";\nimport { uniq } from \"lodash\";\n\nexport function createService<T extends SnakeOrCamelDomains>(\n  domain: T,\n  callService: HassStore[\"helpers\"][\"callService\"],\n  rootTarget?: Target,\n): SupportedServices[SnakeToCamel<T>] {\n  return new Proxy<SupportedServices[SnakeToCamel<T>]>(\n    // @ts-expect-error - purposely not defining the target object here\n    {},\n    {\n      get: <S extends DomainService<T>>(_: unknown, serviceInput: string) => {\n        // service is a string here, so we can assert it as S\n        const service = serviceInput as S;\n        // Skip interception for inherited properties\n        if (service === \"toJSON\") return;\n        return function (args: { target?: Target; serviceData?: ServiceData<T, S>; returnResponse?: boolean }) {\n          const { target: _target, serviceData, returnResponse } = args || {};\n          // use the rootTarget if provided, ignore the target from the args as typescript has an overload for this\n          // flow to disallow a serviceTarget if specified at the hook level.\n          let target = rootTarget ?? _target;\n          if (Array.isArray(target)) {\n            // ensure the target values are a unique array of ids\n            target = [...uniq(target)];\n          }\n          console.info(\n            `${localize(\"perform_action\", {\n              search: \"{name}\",\n              replace: `${domain}.${service}`,\n            })} ${domain}.${service}:`,\n            {\n              target,\n              serviceData,\n              returnResponse,\n            },\n          );\n          return callService({\n            domain,\n            service,\n            serviceData,\n            target,\n            // necessary cast here as the overloads expect true | false | undefined not a boolean\n            returnResponse: returnResponse as true,\n          });\n        };\n      },\n    },\n  );\n}\n\nexport function useService<T extends SnakeOrCamelDomains>(domain: T, rootTarget: Target): SupportedServices<\"no-target\">[SnakeToCamel<T>];\nexport function useService<T extends SnakeOrCamelDomains>(domain: T): SupportedServices[SnakeToCamel<T>];\nexport function useService(): <T extends SnakeOrCamelDomains>(domain: T) => SupportedServices[SnakeToCamel<T>];\nexport function useService<T extends SnakeOrCamelDomains>(domain?: T, rootTarget?: Target) {\n  const { callService } = useHass.getState().helpers;\n\n  const service = useMemo(() => {\n    return domain ? createService(domain, callService, rootTarget) : undefined;\n  }, [domain, callService, rootTarget]);\n\n  const apiWithDomain = useCallback(\n    (inputDomain: SnakeOrCamelDomains) => {\n      return createService(inputDomain, callService, rootTarget);\n    },\n    [callService, rootTarget],\n  );\n\n  return domain ? service : apiWithDomain;\n}\n"],"names":["createService","domain","callService","rootTarget","_","serviceInput","service","args","_target","serviceData","returnResponse","target","uniq","localize","useService","useHass","useMemo","apiWithDomain","useCallback","inputDomain"],"mappings":"uUAOO,SAASA,EACdC,EACAC,EACAC,EACoC,CACpC,OAAO,IAAI,MAET,CAAA,EACA,CACE,IAAK,CAA6BC,EAAYC,IAAyB,CAErE,MAAMC,EAAUD,EAEhB,GAAIC,IAAY,SAChB,OAAO,SAAUC,EAAsF,CACrG,KAAM,CAAE,OAAQC,EAAS,YAAAC,EAAa,eAAAC,CAAA,EAAmBH,GAAQ,CAAA,EAGjE,IAAII,EAASR,GAAcK,EAC3B,OAAI,MAAM,QAAQG,CAAM,IAEtBA,EAAS,CAAC,GAAGC,OAAKD,CAAM,CAAC,GAE3B,QAAQ,KACN,GAAGE,EAAAA,SAAS,iBAAkB,CAC5B,OAAQ,SACR,QAAS,GAAGZ,CAAM,IAAIK,CAAO,EAAA,CAC9B,CAAC,IAAIL,CAAM,IAAIK,CAAO,IACvB,CACE,OAAAK,EACA,YAAAF,EACA,eAAAC,CAAA,CACF,EAEKR,EAAY,CACjB,OAAAD,EACA,QAAAK,EACA,YAAAG,EACA,OAAAE,EAEA,eAAAD,CAAA,CACD,CACH,CACF,CAAA,CACF,CAEJ,CAKO,SAASI,EAA0Cb,EAAYE,EAAqB,CACzF,KAAM,CAAE,YAAAD,CAAA,EAAgBa,UAAQ,WAAW,QAErCT,EAAUU,EAAAA,QAAQ,IACff,EAASD,EAAcC,EAAQC,EAAaC,CAAU,EAAI,OAChE,CAACF,EAAQC,EAAaC,CAAU,CAAC,EAE9Bc,EAAgBC,EAAAA,YACnBC,GACQnB,EAAcmB,EAAajB,EAAaC,CAAU,EAE3D,CAACD,EAAaC,CAAU,CAAA,EAG1B,OAAOF,EAASK,EAAUW,CAC5B"}