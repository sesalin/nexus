{"version":3,"file":"camera.js","sources":["../../../../src/hooks/useCamera/camera.ts"],"sourcesContent":["import { Connection } from \"home-assistant-js-websocket\";\nimport { timeCacheEntityPromiseFunc } from \"./time-cache-entity-promise\";\nimport type { CameraEntity } from \"@core\";\n\nexport interface SignedPath {\n  path: string;\n}\n\nexport const getSignedPath = (connection: Connection, path: string): Promise<SignedPath> =>\n  connection.sendMessagePromise({ type: \"auth/sign_path\", path });\n\nexport interface CameraPreferences {\n  preload_stream: boolean;\n  orientation: number;\n}\n\nexport interface CameraThumbnail {\n  content_type: string;\n  content: string;\n}\n\nexport interface Stream {\n  url: string;\n}\n\nexport const cameraUrlWithWidthHeight = (base_url: string, width: number, height: number) => `${base_url}&width=${width}&height=${height}`;\n\nexport const computeMJPEGStreamUrl = (entity: CameraEntity) =>\n  `/api/camera_proxy_stream/${entity.entity_id}?token=${entity.attributes.access_token}`;\n\nexport const fetchThumbnailUrlWithCache = async (connection: Connection, entityId: string, width: number, height: number) => {\n  const base_url = await timeCacheEntityPromiseFunc(\"_cameraTmbUrl\", 9000, fetchThumbnailUrl, connection, entityId);\n  return cameraUrlWithWidthHeight(base_url, width, height);\n};\n\nexport const fetchThumbnailUrl = async (connection: Connection, entityId: string) => {\n  const { path } = await getSignedPath(connection, `/api/camera_proxy/${entityId}`);\n  return path;\n};\n\nexport const fetchStreamUrl = async (connection: Connection, entityId: string, format?: \"hls\") => {\n  const data = {\n    type: \"camera/stream\",\n    entity_id: entityId,\n  };\n  if (format) {\n    // @ts-expect-error - conditional add\n    data.format = format;\n  }\n  const { url } = await connection.sendMessagePromise<Stream>(data);\n  return url;\n};\n\nexport const fetchCameraPrefs = (connection: Connection, entityId: string) =>\n  connection.sendMessagePromise<CameraPreferences>({\n    type: \"camera/get_prefs\",\n    entity_id: entityId,\n  });\n\nconst CAMERA_MEDIA_SOURCE_PREFIX = \"media-source://camera/\";\n\nexport const isCameraMediaSource = (mediaContentId: string) => mediaContentId.startsWith(CAMERA_MEDIA_SOURCE_PREFIX);\n\nexport const getEntityIdFromCameraMediaSource = (mediaContentId: string) => mediaContentId.substring(CAMERA_MEDIA_SOURCE_PREFIX.length);\n"],"names":["getSignedPath","connection","path","cameraUrlWithWidthHeight","base_url","width","height","computeMJPEGStreamUrl","entity","fetchThumbnailUrlWithCache","entityId","timeCacheEntityPromiseFunc","fetchThumbnailUrl","fetchStreamUrl","format","data","url","fetchCameraPrefs","CAMERA_MEDIA_SOURCE_PREFIX","isCameraMediaSource","mediaContentId","getEntityIdFromCameraMediaSource"],"mappings":"kIAQaA,EAAgB,CAACC,EAAwBC,IACpDD,EAAW,mBAAmB,CAAE,KAAM,iBAAkB,KAAAC,CAAA,CAAM,EAgBnDC,EAA2B,CAACC,EAAkBC,EAAeC,IAAmB,GAAGF,CAAQ,UAAUC,CAAK,WAAWC,CAAM,GAE3HC,EAAyBC,GACpC,4BAA4BA,EAAO,SAAS,UAAUA,EAAO,WAAW,YAAY,GAEzEC,EAA6B,MAAOR,EAAwBS,EAAkBL,EAAeC,IAAmB,CAC3H,MAAMF,EAAW,MAAMO,6BAA2B,gBAAiB,IAAMC,EAAmBX,EAAYS,CAAQ,EAChH,OAAOP,EAAyBC,EAAUC,EAAOC,CAAM,CACzD,EAEaM,EAAoB,MAAOX,EAAwBS,IAAqB,CACnF,KAAM,CAAE,KAAAR,GAAS,MAAMF,EAAcC,EAAY,qBAAqBS,CAAQ,EAAE,EAChF,OAAOR,CACT,EAEaW,EAAiB,MAAOZ,EAAwBS,EAAkBI,IAAmB,CAChG,MAAMC,EAAO,CACX,KAAM,gBACN,UAAWL,CAAA,EAETI,IAEFC,EAAK,OAASD,GAEhB,KAAM,CAAE,IAAAE,CAAA,EAAQ,MAAMf,EAAW,mBAA2Bc,CAAI,EAChE,OAAOC,CACT,EAEaC,EAAmB,CAAChB,EAAwBS,IACvDT,EAAW,mBAAsC,CAC/C,KAAM,mBACN,UAAWS,CACb,CAAC,EAEGQ,EAA6B,yBAEtBC,EAAuBC,GAA2BA,EAAe,WAAWF,CAA0B,EAEtGG,EAAoCD,GAA2BA,EAAe,UAAUF,EAA2B,MAAM"}