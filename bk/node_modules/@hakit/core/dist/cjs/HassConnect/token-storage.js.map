{"version":3,"file":"token-storage.js","sources":["../../../src/HassConnect/token-storage.ts"],"sourcesContent":["import { AuthData } from \"home-assistant-js-websocket\";\n\nconst storage = typeof window !== \"undefined\" ? window.localStorage : null;\nconst supportsStorage = storage !== null;\n\nexport function clearTokens() {\n  if (supportsStorage) {\n    storage.removeItem(\"hassTokens\");\n  } else {\n    console.error(\"Local storage not supported on this device.\");\n  }\n}\n\nexport function saveTokens(tokens: AuthData | null) {\n  if (supportsStorage) {\n    try {\n      storage.setItem(\"hassTokens\", JSON.stringify(tokens));\n    } catch (err: unknown) {\n      // write failed, ignore it. Happens if storage is full or private mode.\n      console.error(\"Failed to save tokens, probably due to private mode or storage full\", err);\n    }\n  } else {\n    console.error(\"Local storage not supported on this device.\");\n  }\n}\n\nexport function loadTokens(hassUrl: string, removeIfInvalid: boolean = true): AuthData | null {\n  if (!supportsStorage) {\n    console.error(\"Local storage not supported on this device.\");\n    return null;\n  }\n  const tokens = storage.getItem(\"hassTokens\");\n  if (tokens) {\n    try {\n      const storedTokens = JSON.parse(tokens) as AuthData;\n      // only return the tokens if the urls match\n      if (storedTokens.hassUrl === hassUrl) {\n        // return the saved tokens\n        return storedTokens;\n      } else if (removeIfInvalid) {\n        // Delete the old token cache.\n        clearTokens();\n        // will force the auth method to retry\n        return null;\n      }\n    } catch (err: unknown) {\n      console.error(\"Error parsing stored tokens.\", (err as Error)?.message || \"\");\n      // Delete the old token cache.\n      clearTokens();\n      // will force the auth method to retry\n      return null;\n    }\n  }\n  // at this point, the provider might be fetching / authenticating\n  return null;\n}\n"],"names":["storage","supportsStorage","clearTokens","saveTokens","tokens","err","loadTokens","hassUrl","removeIfInvalid","storedTokens"],"mappings":"gFAEA,MAAMA,EAAU,OAAO,OAAW,IAAc,OAAO,aAAe,KAChEC,EAAkBD,IAAY,KAE7B,SAASE,GAAc,CACxBD,EACFD,EAAQ,WAAW,YAAY,EAE/B,QAAQ,MAAM,6CAA6C,CAE/D,CAEO,SAASG,EAAWC,EAAyB,CAClD,GAAIH,EACF,GAAI,CACFD,EAAQ,QAAQ,aAAc,KAAK,UAAUI,CAAM,CAAC,CACtD,OAASC,EAAc,CAErB,QAAQ,MAAM,sEAAuEA,CAAG,CAC1F,MAEA,QAAQ,MAAM,6CAA6C,CAE/D,CAEO,SAASC,EAAWC,EAAiBC,EAA2B,GAAuB,CAC5F,GAAI,CAACP,EACH,eAAQ,MAAM,6CAA6C,EACpD,KAET,MAAMG,EAASJ,EAAQ,QAAQ,YAAY,EAC3C,GAAII,EACF,GAAI,CACF,MAAMK,EAAe,KAAK,MAAML,CAAM,EAEtC,GAAIK,EAAa,UAAYF,EAE3B,OAAOE,KACED,EAET,OAAAN,EAAA,EAEO,IAEX,OAASG,EAAc,CACrB,eAAQ,MAAM,+BAAiCA,GAAe,SAAW,EAAE,EAE3EH,EAAA,EAEO,IACT,CAGF,OAAO,IACT"}