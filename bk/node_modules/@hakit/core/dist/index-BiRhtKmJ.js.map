{"version":3,"file":"index-BiRhtKmJ.js","sources":["../src/hooks/useEntity/index.ts","../src/hooks/useIcon/index.tsx"],"sourcesContent":["import { useMemo } from \"react\";\nimport type { HassEntityWithService, HassEntityCustom, ExtractDomain, EntityName } from \"@typings\";\nimport type { HassEntity } from \"home-assistant-js-websocket\";\nimport { getCssColorValue } from \"@utils/colors\";\nimport { timeAgo } from \"@utils/time/time-ago\";\nimport { computeDomain, useHass, useSubscribeEntity, useHistory, useService, getIconByEntity, type HistoryOptions } from \"@core\";\n\nexport interface UseEntityOptions {\n  returnNullIfNotFound?: boolean;\n  historyOptions?: HistoryOptions;\n}\n\nconst DEFAULT_OPTIONS: Required<UseEntityOptions> = {\n  returnNullIfNotFound: false,\n  historyOptions: {\n    hoursToShow: 24,\n    significantChangesOnly: true,\n    minimalResponse: true,\n    disable: true,\n  },\n};\n\nexport type UseEntityReturnType<E, O extends UseEntityOptions> = O[\"returnNullIfNotFound\"] extends true\n  ? HassEntityWithService<ExtractDomain<E>> | null\n  : HassEntityWithService<ExtractDomain<E>>;\n\nfunction formatEntity(entity: HassEntity, language: string | undefined): HassEntityCustom {\n  const now = new Date();\n  const then = new Date(entity.attributes.last_triggered ?? entity.last_updated);\n  const relativeTime = timeAgo(then, language);\n  const timeDiff = Math.abs(now.getTime() - then.getTime());\n  const active = relativeTime === \"just now\";\n  const { hexColor, rgbColor, brightness, brightnessValue, rgbaColor, color } = getCssColorValue(entity);\n  const currentIcon = getIconByEntity(computeDomain(entity.entity_id as EntityName), entity);\n  return {\n    ...entity,\n    attributes: {\n      ...entity.attributes,\n      icon: entity.attributes?.icon || currentIcon,\n    },\n    custom: {\n      color,\n      relativeTime,\n      timeDiff,\n      active,\n      hexColor,\n      rgbColor,\n      brightness,\n      brightnessValue,\n      rgbaColor,\n    },\n  };\n}\n\nexport function useEntity<E extends EntityName, O extends UseEntityOptions = UseEntityOptions>(\n  entity: E,\n  options: O = DEFAULT_OPTIONS as O,\n): UseEntityReturnType<E, O> {\n  const { returnNullIfNotFound, historyOptions } = {\n    ...DEFAULT_OPTIONS,\n    ...options,\n    historyOptions: {\n      ...DEFAULT_OPTIONS.historyOptions,\n      ...options.historyOptions,\n    },\n  };\n  const getEntity = useSubscribeEntity(entity);\n  const rawEntity = getEntity(returnNullIfNotFound);\n  const domain = computeDomain(entity) as ExtractDomain<E>;\n  const service = useService(domain, entity);\n  const history = useHistory(entity, historyOptions);\n  const language = useHass((state) => state.config?.language);\n  const formatted = useMemo(() => (rawEntity ? formatEntity(rawEntity, language) : null), [rawEntity, language]);\n  const entityWithHelpers = useMemo(() => {\n    if (formatted == null) {\n      // purposely casting here so types are correct on usage side\n      // if returnNullIfNotFound is true, we return null, if not we throw an error\n      return null as unknown as UseEntityReturnType<E, O>;\n    }\n    return { ...formatted, service, history } as UseEntityReturnType<E, O>;\n  }, [formatted, service, history]);\n\n  return entityWithHelpers;\n}\n","import { useMemo } from \"react\";\nimport { Icon as IconElement } from \"@iconify/react\";\nimport type { IconProps } from \"@iconify/react\";\nimport { useEntity, computeDomain, AllDomains, CamelToSnake, EntityName } from \"@core\";\nimport { snakeCase } from \"lodash\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\n\nimport { binarySensorIcon } from \"./domains/binary_sensor\";\nimport { sensorIcon } from \"./domains/sensor\";\nimport { numberIcon } from \"./domains/number\";\nimport { coverIcon } from \"./domains/cover\";\nimport { alarmPanelIcon } from \"./domains/alarm\";\nimport { weatherIcon } from \"./domains/weather\";\nimport { FIXED_DOMAIN_ICONS } from \"./domains/constants\";\n\nexport { batteryIconByLevel } from \"./domains/battery\";\n\nexport function useIconByDomain<D extends AllDomains | CamelToSnake<AllDomains> | \"unknown\">(\n  domain: D,\n  iconProps?: Omit<IconProps, \"icon\">,\n) {\n  const iconName = useMemo(() => {\n    const convertedDomainName = snakeCase(domain) as keyof typeof FIXED_DOMAIN_ICONS;\n    if (FIXED_DOMAIN_ICONS[convertedDomainName]) {\n      return FIXED_DOMAIN_ICONS[convertedDomainName];\n    }\n    // If the domain does not match any case, we just return an info icon\n    return \"mdi:information-outline\";\n  }, [domain]);\n  if (iconName === null) {\n    return null;\n  }\n  return (\n    <IconElement\n      style={{\n        fontSize: iconProps?.fontSize ?? \"24px\",\n      }}\n      icon={iconName}\n      {...iconProps}\n    />\n  );\n}\n\nexport function useIcon(icon: string | null, iconProps?: Omit<IconProps, \"icon\">) {\n  const Icon = useMemo(() => {\n    if (icon === null) return null;\n    return (\n      <IconElement\n        style={{\n          fontSize: iconProps?.fontSize ?? \"24px\",\n        }}\n        icon={icon || \"octicon:info-24\"}\n        {...iconProps}\n      />\n    );\n  }, [icon, iconProps]);\n  return Icon;\n}\n\nexport function getIconByEntity(domain: string, entity: HassEntity): string | undefined {\n  const compareState = entity.state;\n\n  switch (domain) {\n    case \"alarm_control_panel\":\n      return alarmPanelIcon(compareState);\n\n    case \"automation\":\n      return compareState === \"unavailable\" ? \"mdi:robot-confused\" : compareState === \"off\" ? \"mdi:robot-off\" : \"mdi:robot\";\n\n    case \"binary_sensor\":\n      return binarySensorIcon(entity);\n\n    case \"button\":\n      switch (entity.attributes.device_class) {\n        case \"identify\":\n          return \"mdi:crosshairs-question\";\n        case \"restart\":\n          return \"mdi:restart\";\n        case \"update\":\n          return \"mdi:package-up\";\n        default:\n          return \"mdi:button-pointer\";\n      }\n\n    case \"camera\":\n      return compareState === \"off\" ? \"mdi:video-off\" : \"mdi:video\";\n\n    case \"cover\":\n      return coverIcon(entity);\n\n    case \"device_tracker\":\n      if (entity.attributes.source_type === \"router\") {\n        return compareState === \"home\" ? \"mdi:lan-connect\" : \"mdi:lan-disconnect\";\n      }\n      if ([\"bluetooth\", \"bluetooth_le\"].includes(entity.attributes.source_type)) {\n        return compareState === \"home\" ? \"mdi:bluetooth-connect\" : \"mdi:bluetooth\";\n      }\n      return compareState === \"not_home\" ? \"mdi:account-arrow-right\" : \"mdi:account\";\n\n    case \"event\":\n      switch (entity.attributes.device_class) {\n        case \"doorbell\":\n          return \"mdi:doorbell\";\n        case \"button\":\n          return \"mdi:gesture-tap-button\";\n        case \"motion\":\n          return \"mdi:motion-sensor\";\n        default:\n          return \"mdi:eye-check\";\n      }\n\n    case \"fan\":\n      return compareState === \"off\" ? \"mdi:fan-off\" : \"mdi:fan\";\n\n    case \"humidifier\":\n      return compareState === \"off\" ? \"mdi:air-humidifier-off\" : \"mdi:air-humidifier\";\n\n    case \"input_boolean\":\n      return compareState === \"on\" ? \"mdi:check-circle-outline\" : \"mdi:close-circle-outline\";\n\n    case \"input_datetime\":\n      if (!entity.attributes.has_date) {\n        return \"mdi:clock\";\n      }\n      if (!entity.attributes.has_time) {\n        return \"mdi:calendar\";\n      }\n      break;\n\n    case \"lock\":\n      switch (compareState) {\n        case \"unlocked\":\n          return \"mdi:lock-open\";\n        case \"jammed\":\n          return \"mdi:lock-alert\";\n        case \"locking\":\n        case \"unlocking\":\n          return \"mdi:lock-clock\";\n        default:\n          return \"mdi:lock\";\n      }\n\n    case \"media_player\":\n      switch (entity.attributes.device_class) {\n        case \"speaker\":\n          switch (compareState) {\n            case \"playing\":\n              return \"mdi:speaker-play\";\n            case \"paused\":\n              return \"mdi:speaker-pause\";\n            case \"off\":\n              return \"mdi:speaker-off\";\n            default:\n              return \"mdi:speaker\";\n          }\n        case \"tv\":\n          switch (compareState) {\n            case \"playing\":\n              return \"mdi:television-play\";\n            case \"paused\":\n              return \"mdi:television-pause\";\n            case \"off\":\n              return \"mdi:television-off\";\n            default:\n              return \"mdi:television\";\n          }\n        case \"receiver\":\n          switch (compareState) {\n            case \"off\":\n              return \"mdi:audio-video-off\";\n            default:\n              return \"mdi:audio-video\";\n          }\n        default:\n          switch (compareState) {\n            case \"playing\":\n            case \"paused\":\n              return \"mdi:cast-connected\";\n            case \"off\":\n              return \"mdi:cast-off\";\n            default:\n              return \"mdi:cast\";\n          }\n      }\n\n    case \"number\": {\n      const icon = numberIcon(entity);\n      if (icon) {\n        return icon;\n      }\n\n      break;\n    }\n\n    case \"person\":\n      return compareState === \"not_home\" ? \"mdi:account-arrow-right\" : \"mdi:account\";\n\n    case \"switch\":\n      switch (entity.attributes.device_class) {\n        case \"outlet\":\n          return compareState === \"on\" ? \"mdi:power-plug\" : \"mdi:power-plug-off\";\n        case \"switch\":\n          return compareState === \"on\" ? \"mdi:toggle-switch-variant\" : \"mdi:toggle-switch-variant-off\";\n        default:\n          return \"mdi:toggle-switch-variant\";\n      }\n\n    case \"sensor\": {\n      const icon = sensorIcon(entity);\n      if (icon) {\n        return icon;\n      }\n      break;\n    }\n\n    case \"sun\":\n      return entity.state === \"above_horizon\" ? \"mdi:white-balance-sunny\" : \"mdi:weather-night\";\n\n    case \"switch_as_x\":\n      return \"mdi:swap-horizontal\";\n\n    case \"threshold\":\n      return \"mdi:chart-sankey\";\n\n    case \"update\":\n      return \"mdi:package\";\n    case \"water_heater\":\n      return compareState === \"off\" ? \"mdi:water-boiler-off\" : \"mdi:water-boiler\";\n\n    case \"weather\":\n      return weatherIcon(entity.state);\n  }\n\n  if (domain in FIXED_DOMAIN_ICONS) {\n    return FIXED_DOMAIN_ICONS[domain as keyof typeof FIXED_DOMAIN_ICONS];\n  }\n\n  return undefined;\n}\n\nexport function useIconByEntity<E extends EntityName>(_entity: E, iconProps?: Omit<IconProps, \"icon\">) {\n  const entity = useEntity(_entity || \"unknown\", {\n    returnNullIfNotFound: true,\n  });\n  const Icon = useMemo(() => {\n    if (entity === null) return null;\n    const icon = entity.attributes.icon ?? getIconByEntity(computeDomain(_entity), entity);\n    if (!icon) {\n      return null;\n    }\n    return (\n      <IconElement\n        style={{\n          fontSize: iconProps?.fontSize ?? \"24px\",\n        }}\n        icon={icon}\n        {...iconProps}\n      />\n    );\n  }, [entity, _entity, iconProps]);\n  return Icon;\n}\n"],"names":["DEFAULT_OPTIONS","formatEntity","entity","language","now","then","relativeTime","timeAgo","timeDiff","active","hexColor","rgbColor","brightness","brightnessValue","rgbaColor","color","getCssColorValue","currentIcon","getIconByEntity","computeDomain","useEntity","options","returnNullIfNotFound","historyOptions","rawEntity","useSubscribeEntity","domain","service","useService","history","useHistory","useHass","state","formatted","useMemo","useIconByDomain","iconProps","iconName","convertedDomainName","snakeCase","FIXED_DOMAIN_ICONS","jsx","IconElement","useIcon","icon","compareState","alarmPanelIcon","binarySensorIcon","coverIcon","numberIcon","sensorIcon","weatherIcon","useIconByEntity","_entity"],"mappings":"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"}