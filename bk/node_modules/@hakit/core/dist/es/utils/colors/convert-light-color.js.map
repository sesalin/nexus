{"version":3,"file":"convert-light-color.js","sources":["../../../../src/utils/colors/convert-light-color.ts"],"sourcesContent":["import { clamp } from \"lodash\";\n\nconst DEFAULT_MIN_KELVIN = 2700;\nconst DEFAULT_MAX_KELVIN = 6500;\n\nexport const temperature2rgb = (temperature: number): [number, number, number] => {\n  const value = temperature / 100;\n  return [temperatureRed(value), temperatureGreen(value), temperatureBlue(value)];\n};\n\nconst temperatureRed = (temperature: number): number => {\n  if (temperature <= 66) {\n    return 255;\n  }\n  const red = 329.698727446 * (temperature - 60) ** -0.1332047592;\n  return clamp(red, 0, 255);\n};\n\nconst temperatureGreen = (temperature: number): number => {\n  let green: number;\n  if (temperature <= 66) {\n    green = 99.4708025861 * Math.log(temperature) - 161.1195681661;\n  } else {\n    green = 288.1221695283 * (temperature - 60) ** -0.0755148492;\n  }\n  return clamp(green, 0, 255);\n};\n\nconst temperatureBlue = (temperature: number): number => {\n  if (temperature >= 66) {\n    return 255;\n  }\n  if (temperature <= 19) {\n    return 0;\n  }\n  const blue = 138.5177312231 * Math.log(temperature - 10) - 305.0447927307;\n  return clamp(blue, 0, 255);\n};\n\nconst matchMaxScale = (inputColors: number[], outputColors: number[]): number[] => {\n  const maxIn: number = Math.max(...inputColors);\n  const maxOut: number = Math.max(...outputColors);\n  let factor: number;\n  if (maxOut === 0) {\n    factor = 0.0;\n  } else {\n    factor = maxIn / maxOut;\n  }\n  return outputColors.map((value) => Math.round(value * factor));\n};\n\nconst mired2kelvin = (miredTemperature: number) => Math.floor(1000000 / miredTemperature);\n\nconst kelvin2mired = (kelvintTemperature: number) => Math.floor(1000000 / kelvintTemperature);\n\nexport const rgbww2rgb = (\n  rgbww: [number, number, number, number, number],\n  minKelvin?: number,\n  maxKelvin?: number,\n): [number, number, number] => {\n  const [r, g, b, cw, ww] = rgbww;\n  // Calculate color temperature of the white channels\n  const maxMireds: number = kelvin2mired(minKelvin ?? DEFAULT_MIN_KELVIN);\n  const minMireds: number = kelvin2mired(maxKelvin ?? DEFAULT_MAX_KELVIN);\n  const miredRange: number = maxMireds - minMireds;\n  let ctRatio: number;\n  try {\n    ctRatio = ww / (cw + ww);\n  } catch (_error) {\n    console.log(\"Error:\", _error);\n    ctRatio = 0.5;\n  }\n  const colorTempMired = minMireds + ctRatio * miredRange;\n  const colorTempKelvin = colorTempMired ? mired2kelvin(colorTempMired) : 0;\n  const [wR, wG, wB] = temperature2rgb(colorTempKelvin);\n  const whiteLevel = Math.max(cw, ww) / 255;\n\n  // Add the white channels to the rgb channels.\n  const rgb = [r + wR * whiteLevel, g + wG * whiteLevel, b + wB * whiteLevel] as [number, number, number];\n\n  // Match the output maximum value to the input. This ensures the\n  // output doesn't overflow.\n  return matchMaxScale([r, g, b, cw, ww], rgb) as [number, number, number];\n};\n\nexport const rgbw2rgb = (rgbw: [number, number, number, number]): [number, number, number] => {\n  const [r, g, b, w] = rgbw;\n  const rgb = [r + w, g + w, b + w] as [number, number, number];\n  return matchMaxScale([r, g, b, w], rgb) as [number, number, number];\n};\n"],"names":["DEFAULT_MIN_KELVIN","DEFAULT_MAX_KELVIN","temperature2rgb","temperature","value","temperatureRed","temperatureGreen","temperatureBlue","red","clamp","green","blue","matchMaxScale","inputColors","outputColors","maxIn","maxOut","factor","mired2kelvin","miredTemperature","kelvin2mired","kelvintTemperature","rgbww2rgb","rgbww","minKelvin","maxKelvin","r","g","b","cw","ww","maxMireds","minMireds","miredRange","ctRatio","_error","colorTempMired","colorTempKelvin","wR","wG","wB","whiteLevel","rgb","rgbw2rgb","rgbw","w"],"mappings":";AAEA,MAAMA,IAAqB,MACrBC,IAAqB,MAEdC,IAAkB,CAACC,MAAkD;AAChF,QAAMC,IAAQD,IAAc;AAC5B,SAAO,CAACE,EAAeD,CAAK,GAAGE,EAAiBF,CAAK,GAAGG,EAAgBH,CAAK,CAAC;AAChF,GAEMC,IAAiB,CAACF,MAAgC;AACtD,MAAIA,KAAe;AACjB,WAAO;AAET,QAAMK,IAAM,iBAAiBL,IAAc,OAAO;AAClD,SAAOM,EAAMD,GAAK,GAAG,GAAG;AAC1B,GAEMF,IAAmB,CAACH,MAAgC;AACxD,MAAIO;AACJ,SAAIP,KAAe,KACjBO,IAAQ,gBAAgB,KAAK,IAAIP,CAAW,IAAI,iBAEhDO,IAAQ,kBAAkBP,IAAc,OAAO,eAE1CM,EAAMC,GAAO,GAAG,GAAG;AAC5B,GAEMH,IAAkB,CAACJ,MAAgC;AACvD,MAAIA,KAAe;AACjB,WAAO;AAET,MAAIA,KAAe;AACjB,WAAO;AAET,QAAMQ,IAAO,iBAAiB,KAAK,IAAIR,IAAc,EAAE,IAAI;AAC3D,SAAOM,EAAME,GAAM,GAAG,GAAG;AAC3B,GAEMC,IAAgB,CAACC,GAAuBC,MAAqC;AACjF,QAAMC,IAAgB,KAAK,IAAI,GAAGF,CAAW,GACvCG,IAAiB,KAAK,IAAI,GAAGF,CAAY;AAC/C,MAAIG;AACJ,SAAID,MAAW,IACbC,IAAS,IAETA,IAASF,IAAQC,GAEZF,EAAa,IAAI,CAACV,MAAU,KAAK,MAAMA,IAAQa,CAAM,CAAC;AAC/D,GAEMC,IAAe,CAACC,MAA6B,KAAK,MAAM,MAAUA,CAAgB,GAElFC,IAAe,CAACC,MAA+B,KAAK,MAAM,MAAUA,CAAkB,GAE/EC,IAAY,CACvBC,GACAC,GACAC,MAC6B;AAC7B,QAAM,CAACC,GAAGC,GAAGC,GAAGC,GAAIC,CAAE,IAAIP,GAEpBQ,IAAoBX,EAAaI,KAAaxB,CAAkB,GAChEgC,IAAoBZ,EAAaK,KAAaxB,CAAkB,GAChEgC,IAAqBF,IAAYC;AACvC,MAAIE;AACJ,MAAI;AACF,IAAAA,IAAUJ,KAAMD,IAAKC;AAAA,EACvB,SAASK,GAAQ;AACf,YAAQ,IAAI,UAAUA,CAAM,GAC5BD,IAAU;AAAA,EACZ;AACA,QAAME,IAAiBJ,IAAYE,IAAUD,GACvCI,IAAkBD,IAAiBlB,EAAakB,CAAc,IAAI,GAClE,CAACE,GAAIC,GAAIC,CAAE,IAAItC,EAAgBmC,CAAe,GAC9CI,IAAa,KAAK,IAAIZ,GAAIC,CAAE,IAAI,KAGhCY,IAAM,CAAChB,IAAIY,IAAKG,GAAYd,IAAIY,IAAKE,GAAYb,IAAIY,IAAKC,CAAU;AAI1E,SAAO7B,EAAc,CAACc,GAAGC,GAAGC,GAAGC,GAAIC,CAAE,GAAGY,CAAG;AAC7C,GAEaC,IAAW,CAACC,MAAqE;AAC5F,QAAM,CAAC,GAAGjB,GAAGC,GAAGiB,CAAC,IAAID,GACfF,IAAM,CAAC,IAAIG,GAAGlB,IAAIkB,GAAGjB,IAAIiB,CAAC;AAChC,SAAOjC,EAAc,CAAC,GAAGe,GAAGC,GAAGiB,CAAC,GAAGH,CAAG;AACxC;"}