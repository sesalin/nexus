{"version":3,"file":"frontend_data.js","sources":["../../../../src/utils/subscribe/frontend_data.ts"],"sourcesContent":["import { Connection } from \"home-assistant-js-websocket\";\n\nimport { localeTranslations } from \"../../hooks/useLocale/locales\";\nimport { TimeZone, TimeFormat } from \"@utils/date\";\n\nexport interface FrontendLocaleData {\n  language: string;\n  number_format: NumberFormat;\n  time_format: TimeFormat;\n  date_format: DateFormat;\n  first_weekday: FirstWeekday;\n  time_zone: TimeZone;\n}\ninterface FrontendUserData {\n  language: FrontendLocaleData;\n}\n\nexport enum NumberFormat {\n  language = \"language\",\n  system = \"system\",\n  comma_decimal = \"comma_decimal\",\n  decimal_comma = \"decimal_comma\",\n  quote_decimal = \"quote_decimal\",\n  space_comma = \"space_comma\",\n  none = \"none\",\n}\n\nexport enum DateFormat {\n  language = \"language\",\n  system = \"system\",\n  DMY = \"DMY\",\n  MDY = \"MDY\",\n  YMD = \"YMD\",\n}\n\nexport enum FirstWeekday {\n  language = \"language\",\n  monday = \"monday\",\n  tuesday = \"tuesday\",\n  wednesday = \"wednesday\",\n  thursday = \"thursday\",\n  friday = \"friday\",\n  saturday = \"saturday\",\n  sunday = \"sunday\",\n}\n\nexport type ValidUserDataKey = keyof FrontendUserData;\n\nexport const subscribeFrontendUserData = <UserDataKey extends ValidUserDataKey>(\n  conn: Connection,\n  userDataKey: UserDataKey,\n  onChange: (data: { value: FrontendUserData[UserDataKey] | null }) => void,\n) =>\n  conn.subscribeMessage<{ value: FrontendUserData[UserDataKey] | null }>(onChange, {\n    type: \"frontend/subscribe_user_data\",\n    key: userDataKey,\n  });\n\n// Chinese locales need map to Simplified or Traditional Chinese\nconst LOCALE_LOOKUP = {\n  \"zh-cn\": \"zh-Hans\",\n  \"zh-sg\": \"zh-Hans\",\n  \"zh-my\": \"zh-Hans\",\n  \"zh-tw\": \"zh-Hant\",\n  \"zh-hk\": \"zh-Hant\",\n  \"zh-mo\": \"zh-Hant\",\n  zh: \"zh-Hant\", // all other Chinese locales map to Traditional Chinese\n};\n\n/**\n * Search for a matching translation from most specific to general\n */\nexport function findAvailableLanguage(language: string) {\n  // In most case, the language has the same format with our translation meta data\n  if (localeTranslations.find((lang) => lang.code === language)) {\n    return language;\n  }\n\n  // Perform case-insensitive comparison since browser isn't required to\n  // report languages with specific cases.\n  const langLower = language.toLowerCase();\n\n  if (langLower in LOCALE_LOOKUP) {\n    return LOCALE_LOOKUP[langLower as keyof typeof LOCALE_LOOKUP];\n  }\n\n  const translation = localeTranslations.find((lang) => lang.code.toLowerCase() === langLower);\n  if (translation) {\n    return translation.code;\n  }\n\n  if (language.includes(\"-\")) {\n    return findAvailableLanguage(language.split(\"-\")[0]);\n  }\n\n  return undefined;\n}\n\n/**\n * Get user selected locale data from backend\n */\nexport function getUserLocaleLanguage(data: FrontendLocaleData): string {\n  const language = data.language;\n  if (language) {\n    const availableLanguage = findAvailableLanguage(language);\n    if (availableLanguage) {\n      return availableLanguage;\n    }\n  }\n  return language;\n}\n"],"names":["NumberFormat","DateFormat","FirstWeekday","subscribeFrontendUserData","conn","userDataKey","onChange","LOCALE_LOOKUP","findAvailableLanguage","language","localeTranslations","lang","langLower","translation","getUserLocaleLanguage","data","availableLanguage"],"mappings":";AAiBO,IAAKA,sBAAAA,OACVA,EAAA,WAAW,YACXA,EAAA,SAAS,UACTA,EAAA,gBAAgB,iBAChBA,EAAA,gBAAgB,iBAChBA,EAAA,gBAAgB,iBAChBA,EAAA,cAAc,eACdA,EAAA,OAAO,QAPGA,IAAAA,KAAA,CAAA,CAAA,GAUAC,sBAAAA,OACVA,EAAA,WAAW,YACXA,EAAA,SAAS,UACTA,EAAA,MAAM,OACNA,EAAA,MAAM,OACNA,EAAA,MAAM,OALIA,IAAAA,KAAA,CAAA,CAAA,GAQAC,sBAAAA,OACVA,EAAA,WAAW,YACXA,EAAA,SAAS,UACTA,EAAA,UAAU,WACVA,EAAA,YAAY,aACZA,EAAA,WAAW,YACXA,EAAA,SAAS,UACTA,EAAA,WAAW,YACXA,EAAA,SAAS,UARCA,IAAAA,KAAA,CAAA,CAAA;AAaL,MAAMC,IAA4B,CACvCC,GACAC,GACAC,MAEAF,EAAK,iBAAkEE,GAAU;AAAA,EAC/E,MAAM;AAAA,EACN,KAAKD;AACP,CAAC,GAGGE,IAAgB;AAAA,EACpB,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,SAAS;AAAA,EACT,IAAI;AAAA;AACN;AAKO,SAASC,EAAsBC,GAAkB;AAEtD,MAAIC,EAAmB,KAAK,CAACC,MAASA,EAAK,SAASF,CAAQ;AAC1D,WAAOA;AAKT,QAAMG,IAAYH,EAAS,YAAA;AAE3B,MAAIG,KAAaL;AACf,WAAOA,EAAcK,CAAuC;AAG9D,QAAMC,IAAcH,EAAmB,KAAK,CAACC,MAASA,EAAK,KAAK,YAAA,MAAkBC,CAAS;AAC3F,MAAIC;AACF,WAAOA,EAAY;AAGrB,MAAIJ,EAAS,SAAS,GAAG;AACvB,WAAOD,EAAsBC,EAAS,MAAM,GAAG,EAAE,CAAC,CAAC;AAIvD;AAKO,SAASK,EAAsBC,GAAkC;AACtE,QAAMN,IAAWM,EAAK;AACtB,MAAIN,GAAU;AACZ,UAAMO,IAAoBR,EAAsBC,CAAQ;AACxD,QAAIO;AACF,aAAOA;AAAA,EAEX;AACA,SAAOP;AACT;"}