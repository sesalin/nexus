{"version":3,"file":"camera.js","sources":["../../../../src/hooks/useCamera/camera.ts"],"sourcesContent":["import { Connection } from \"home-assistant-js-websocket\";\nimport { timeCacheEntityPromiseFunc } from \"./time-cache-entity-promise\";\nimport type { CameraEntity } from \"@core\";\n\nexport interface SignedPath {\n  path: string;\n}\n\nexport const getSignedPath = (connection: Connection, path: string): Promise<SignedPath> =>\n  connection.sendMessagePromise({ type: \"auth/sign_path\", path });\n\nexport interface CameraPreferences {\n  preload_stream: boolean;\n  orientation: number;\n}\n\nexport interface CameraThumbnail {\n  content_type: string;\n  content: string;\n}\n\nexport interface Stream {\n  url: string;\n}\n\nexport const cameraUrlWithWidthHeight = (base_url: string, width: number, height: number) => `${base_url}&width=${width}&height=${height}`;\n\nexport const computeMJPEGStreamUrl = (entity: CameraEntity) =>\n  `/api/camera_proxy_stream/${entity.entity_id}?token=${entity.attributes.access_token}`;\n\nexport const fetchThumbnailUrlWithCache = async (connection: Connection, entityId: string, width: number, height: number) => {\n  const base_url = await timeCacheEntityPromiseFunc(\"_cameraTmbUrl\", 9000, fetchThumbnailUrl, connection, entityId);\n  return cameraUrlWithWidthHeight(base_url, width, height);\n};\n\nexport const fetchThumbnailUrl = async (connection: Connection, entityId: string) => {\n  const { path } = await getSignedPath(connection, `/api/camera_proxy/${entityId}`);\n  return path;\n};\n\nexport const fetchStreamUrl = async (connection: Connection, entityId: string, format?: \"hls\") => {\n  const data = {\n    type: \"camera/stream\",\n    entity_id: entityId,\n  };\n  if (format) {\n    // @ts-expect-error - conditional add\n    data.format = format;\n  }\n  const { url } = await connection.sendMessagePromise<Stream>(data);\n  return url;\n};\n\nexport const fetchCameraPrefs = (connection: Connection, entityId: string) =>\n  connection.sendMessagePromise<CameraPreferences>({\n    type: \"camera/get_prefs\",\n    entity_id: entityId,\n  });\n\nconst CAMERA_MEDIA_SOURCE_PREFIX = \"media-source://camera/\";\n\nexport const isCameraMediaSource = (mediaContentId: string) => mediaContentId.startsWith(CAMERA_MEDIA_SOURCE_PREFIX);\n\nexport const getEntityIdFromCameraMediaSource = (mediaContentId: string) => mediaContentId.substring(CAMERA_MEDIA_SOURCE_PREFIX.length);\n"],"names":["getSignedPath","connection","path","cameraUrlWithWidthHeight","base_url","width","height","computeMJPEGStreamUrl","entity","fetchThumbnailUrlWithCache","entityId","timeCacheEntityPromiseFunc","fetchThumbnailUrl","fetchStreamUrl","format","data","url","fetchCameraPrefs","CAMERA_MEDIA_SOURCE_PREFIX","isCameraMediaSource","mediaContentId","getEntityIdFromCameraMediaSource"],"mappings":";AAQO,MAAMA,IAAgB,CAACC,GAAwBC,MACpDD,EAAW,mBAAmB,EAAE,MAAM,kBAAkB,MAAAC,EAAA,CAAM,GAgBnDC,IAA2B,CAACC,GAAkBC,GAAeC,MAAmB,GAAGF,CAAQ,UAAUC,CAAK,WAAWC,CAAM,IAE3HC,IAAwB,CAACC,MACpC,4BAA4BA,EAAO,SAAS,UAAUA,EAAO,WAAW,YAAY,IAEzEC,IAA6B,OAAOR,GAAwBS,GAAkBL,GAAeC,MAAmB;AAC3H,QAAMF,IAAW,MAAMO,EAA2B,iBAAiB,KAAMC,GAAmBX,GAAYS,CAAQ;AAChH,SAAOP,EAAyBC,GAAUC,GAAOC,CAAM;AACzD,GAEaM,IAAoB,OAAOX,GAAwBS,MAAqB;AACnF,QAAM,EAAE,MAAAR,MAAS,MAAMF,EAAcC,GAAY,qBAAqBS,CAAQ,EAAE;AAChF,SAAOR;AACT,GAEaW,IAAiB,OAAOZ,GAAwBS,GAAkBI,MAAmB;AAChG,QAAMC,IAAO;AAAA,IACX,MAAM;AAAA,IACN,WAAWL;AAAA,EAAA;AAEb,EAAII,MAEFC,EAAK,SAASD;AAEhB,QAAM,EAAE,KAAAE,EAAA,IAAQ,MAAMf,EAAW,mBAA2Bc,CAAI;AAChE,SAAOC;AACT,GAEaC,IAAmB,CAAChB,GAAwBS,MACvDT,EAAW,mBAAsC;AAAA,EAC/C,MAAM;AAAA,EACN,WAAWS;AACb,CAAC,GAEGQ,IAA6B,0BAEtBC,IAAsB,CAACC,MAA2BA,EAAe,WAAWF,CAA0B,GAEtGG,IAAmC,CAACD,MAA2BA,EAAe,UAAUF,EAA2B,MAAM;"}