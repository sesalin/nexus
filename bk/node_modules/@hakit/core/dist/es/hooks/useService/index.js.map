{"version":3,"file":"index.js","sources":["../../../../src/hooks/useService/index.ts"],"sourcesContent":["import { useMemo, useCallback } from \"react\";\nimport { useHass } from \"@core\";\nimport { localize } from \"../useLocale\";\nimport type { SupportedServices, DomainService, SnakeOrCamelDomains, ServiceData, SnakeToCamel, Target } from \"@typings\";\nimport type { HassStore } from \"@core\";\nimport { uniq } from \"lodash\";\n\nexport function createService<T extends SnakeOrCamelDomains>(\n  domain: T,\n  callService: HassStore[\"helpers\"][\"callService\"],\n  rootTarget?: Target,\n): SupportedServices[SnakeToCamel<T>] {\n  return new Proxy<SupportedServices[SnakeToCamel<T>]>(\n    // @ts-expect-error - purposely not defining the target object here\n    {},\n    {\n      get: <S extends DomainService<T>>(_: unknown, serviceInput: string) => {\n        // service is a string here, so we can assert it as S\n        const service = serviceInput as S;\n        // Skip interception for inherited properties\n        if (service === \"toJSON\") return;\n        return function (args: { target?: Target; serviceData?: ServiceData<T, S>; returnResponse?: boolean }) {\n          const { target: _target, serviceData, returnResponse } = args || {};\n          // use the rootTarget if provided, ignore the target from the args as typescript has an overload for this\n          // flow to disallow a serviceTarget if specified at the hook level.\n          let target = rootTarget ?? _target;\n          if (Array.isArray(target)) {\n            // ensure the target values are a unique array of ids\n            target = [...uniq(target)];\n          }\n          console.info(\n            `${localize(\"perform_action\", {\n              search: \"{name}\",\n              replace: `${domain}.${service}`,\n            })} ${domain}.${service}:`,\n            {\n              target,\n              serviceData,\n              returnResponse,\n            },\n          );\n          return callService({\n            domain,\n            service,\n            serviceData,\n            target,\n            // necessary cast here as the overloads expect true | false | undefined not a boolean\n            returnResponse: returnResponse as true,\n          });\n        };\n      },\n    },\n  );\n}\n\nexport function useService<T extends SnakeOrCamelDomains>(domain: T, rootTarget: Target): SupportedServices<\"no-target\">[SnakeToCamel<T>];\nexport function useService<T extends SnakeOrCamelDomains>(domain: T): SupportedServices[SnakeToCamel<T>];\nexport function useService(): <T extends SnakeOrCamelDomains>(domain: T) => SupportedServices[SnakeToCamel<T>];\nexport function useService<T extends SnakeOrCamelDomains>(domain?: T, rootTarget?: Target) {\n  const { callService } = useHass.getState().helpers;\n\n  const service = useMemo(() => {\n    return domain ? createService(domain, callService, rootTarget) : undefined;\n  }, [domain, callService, rootTarget]);\n\n  const apiWithDomain = useCallback(\n    (inputDomain: SnakeOrCamelDomains) => {\n      return createService(inputDomain, callService, rootTarget);\n    },\n    [callService, rootTarget],\n  );\n\n  return domain ? service : apiWithDomain;\n}\n"],"names":["createService","domain","callService","rootTarget","_","serviceInput","service","args","_target","serviceData","returnResponse","target","uniq","localize","useService","useHass","useMemo","apiWithDomain","useCallback","inputDomain"],"mappings":";;;;;;;;AAOO,SAASA,EACdC,GACAC,GACAC,GACoC;AACpC,SAAO,IAAI;AAAA;AAAA,IAET,CAAA;AAAA,IACA;AAAA,MACE,KAAK,CAA6BC,GAAYC,MAAyB;AAErE,cAAMC,IAAUD;AAEhB,YAAIC,MAAY;AAChB,iBAAO,SAAUC,GAAsF;AACrG,kBAAM,EAAE,QAAQC,GAAS,aAAAC,GAAa,gBAAAC,EAAA,IAAmBH,KAAQ,CAAA;AAGjE,gBAAII,IAASR,KAAcK;AAC3B,mBAAI,MAAM,QAAQG,CAAM,MAEtBA,IAAS,CAAC,GAAGC,EAAKD,CAAM,CAAC,IAE3B,QAAQ;AAAA,cACN,GAAGE,EAAS,kBAAkB;AAAA,gBAC5B,QAAQ;AAAA,gBACR,SAAS,GAAGZ,CAAM,IAAIK,CAAO;AAAA,cAAA,CAC9B,CAAC,IAAIL,CAAM,IAAIK,CAAO;AAAA,cACvB;AAAA,gBACE,QAAAK;AAAA,gBACA,aAAAF;AAAA,gBACA,gBAAAC;AAAA,cAAA;AAAA,YACF,GAEKR,EAAY;AAAA,cACjB,QAAAD;AAAA,cACA,SAAAK;AAAA,cACA,aAAAG;AAAA,cACA,QAAAE;AAAA;AAAA,cAEA,gBAAAD;AAAA,YAAA,CACD;AAAA,UACH;AAAA,MACF;AAAA,IAAA;AAAA,EACF;AAEJ;AAKO,SAASI,EAA0Cb,GAAYE,GAAqB;AACzF,QAAM,EAAE,aAAAD,EAAA,IAAgBa,EAAQ,WAAW,SAErCT,IAAUU,EAAQ,MACff,IAASD,EAAcC,GAAQC,GAAaC,CAAU,IAAI,QAChE,CAACF,GAAQC,GAAaC,CAAU,CAAC,GAE9Bc,IAAgBC;AAAA,IACpB,CAACC,MACQnB,EAAcmB,GAAajB,GAAaC,CAAU;AAAA,IAE3D,CAACD,GAAaC,CAAU;AAAA,EAAA;AAG1B,SAAOF,IAASK,IAAUW;AAC5B;"}