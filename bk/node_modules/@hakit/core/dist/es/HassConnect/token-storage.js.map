{"version":3,"file":"token-storage.js","sources":["../../../src/HassConnect/token-storage.ts"],"sourcesContent":["import { AuthData } from \"home-assistant-js-websocket\";\n\nconst storage = typeof window !== \"undefined\" ? window.localStorage : null;\nconst supportsStorage = storage !== null;\n\nexport function clearTokens() {\n  if (supportsStorage) {\n    storage.removeItem(\"hassTokens\");\n  } else {\n    console.error(\"Local storage not supported on this device.\");\n  }\n}\n\nexport function saveTokens(tokens: AuthData | null) {\n  if (supportsStorage) {\n    try {\n      storage.setItem(\"hassTokens\", JSON.stringify(tokens));\n    } catch (err: unknown) {\n      // write failed, ignore it. Happens if storage is full or private mode.\n      console.error(\"Failed to save tokens, probably due to private mode or storage full\", err);\n    }\n  } else {\n    console.error(\"Local storage not supported on this device.\");\n  }\n}\n\nexport function loadTokens(hassUrl: string, removeIfInvalid: boolean = true): AuthData | null {\n  if (!supportsStorage) {\n    console.error(\"Local storage not supported on this device.\");\n    return null;\n  }\n  const tokens = storage.getItem(\"hassTokens\");\n  if (tokens) {\n    try {\n      const storedTokens = JSON.parse(tokens) as AuthData;\n      // only return the tokens if the urls match\n      if (storedTokens.hassUrl === hassUrl) {\n        // return the saved tokens\n        return storedTokens;\n      } else if (removeIfInvalid) {\n        // Delete the old token cache.\n        clearTokens();\n        // will force the auth method to retry\n        return null;\n      }\n    } catch (err: unknown) {\n      console.error(\"Error parsing stored tokens.\", (err as Error)?.message || \"\");\n      // Delete the old token cache.\n      clearTokens();\n      // will force the auth method to retry\n      return null;\n    }\n  }\n  // at this point, the provider might be fetching / authenticating\n  return null;\n}\n"],"names":["storage","supportsStorage","clearTokens","saveTokens","tokens","err","loadTokens","hassUrl","removeIfInvalid","storedTokens"],"mappings":"AAEA,MAAMA,IAAU,OAAO,SAAW,MAAc,OAAO,eAAe,MAChEC,IAAkBD,MAAY;AAE7B,SAASE,IAAc;AAC5B,EAAID,IACFD,EAAQ,WAAW,YAAY,IAE/B,QAAQ,MAAM,6CAA6C;AAE/D;AAEO,SAASG,EAAWC,GAAyB;AAClD,MAAIH;AACF,QAAI;AACF,MAAAD,EAAQ,QAAQ,cAAc,KAAK,UAAUI,CAAM,CAAC;AAAA,IACtD,SAASC,GAAc;AAErB,cAAQ,MAAM,uEAAuEA,CAAG;AAAA,IAC1F;AAAA;AAEA,YAAQ,MAAM,6CAA6C;AAE/D;AAEO,SAASC,EAAWC,GAAiBC,IAA2B,IAAuB;AAC5F,MAAI,CAACP;AACH,mBAAQ,MAAM,6CAA6C,GACpD;AAET,QAAMG,IAASJ,EAAQ,QAAQ,YAAY;AAC3C,MAAII;AACF,QAAI;AACF,YAAMK,IAAe,KAAK,MAAML,CAAM;AAEtC,UAAIK,EAAa,YAAYF;AAE3B,eAAOE;UACED;AAET,eAAAN,EAAA,GAEO;AAAA,IAEX,SAASG,GAAc;AACrB,qBAAQ,MAAM,gCAAiCA,GAAe,WAAW,EAAE,GAE3EH,EAAA,GAEO;AAAA,IACT;AAGF,SAAO;AACT;"}